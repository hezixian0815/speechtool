package com.aispeech.export.engines2;

import android.text.TextUtils;

import com.aispeech.AIError;
import com.aispeech.AIResult;
import com.aispeech.DUILiteConfig;
import com.aispeech.base.IFespxEngine;
import com.aispeech.common.AIConstant;
import com.aispeech.common.JNIFlag;
import com.aispeech.common.Log;
import com.aispeech.common.Util;
import com.aispeech.export.config.AILocalSignalAndWakeupConfig;
import com.aispeech.export.config.WakeupWord;
import com.aispeech.export.intent.AILocalSignalAndWakeupIntent;
import com.aispeech.export.listeners.AILocalSignalAndWakeupListener;
import com.aispeech.kernel.Fespa;
import com.aispeech.kernel.Fespd;
import com.aispeech.kernel.Fespl;
import com.aispeech.kernel.NearFespx;
import com.aispeech.kernel.Sspe;
import com.aispeech.kernel.fespCar;
import com.aispeech.lite.AISpeech;
import com.aispeech.lite.base.BaseEngine;
import com.aispeech.lite.config.LocalSignalProcessingConfig;
import com.aispeech.lite.fespx.FespxProcessor;
import com.aispeech.lite.param.SignalProcessingParams;
import com.aispeech.lite.speech.SpeechListener;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.io.File;
import java.lang.reflect.Array;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Locale;
import java.util.Map;

/**
 * 多麦唤醒
 */
public class AILocalSignalAndWakeupEngine extends BaseEngine implements IFespxEngine {
    private static final String TAG = "AILSAWEngine";
    private static final String ACCESSIONAL_HEX = "FCFF0800FFFF0000FDFFFBFFFDFF050000000000FEFFFBFFFFFF0300FFFF0100FFFFFEFFFEFF0100FDFF02000200000001000200FEFF03000200FFFF00000200010004000200020001000000010003000100020003000200010005000000050001000400FFFF0500FFFF0500000004000000030001000300020002000100020002000400010004000100050000000100FFFF050001000500FFFF0100FEFF050001000600FEFF0000FEFF020002000400010000000200040002000700010002000200030003000400FFFF02000100030001000700FFFF0400FFFF01000000040000000300FFFFFEFF020002000100050000000000020001000000050001000000FFFFFEFFFFFF0600FFFFFFFFFEFFFEFFFFFF0500FEFF0200FEFFFEFF01000500FFFF0600FFFF010000000300FEFF04000000FEFFFFFF0000FDFF0400FFFF0100FEFF0000FEFF04000000FFFF00000000FFFF0400FFFF01000000000000000300FEFF0300FFFF0100000003000100030001000200FFFF01000100010003000500010005000400030003000500010004000200040002000400030005000200040003000400030004000300050001000300020004000200050001000100010003000200030002000300020002000200040003000400040003000200070003000500030004000200060003000400030002000100040003000800020005000000030004000800030006000100030004000600020004000300020003000600030005000300010002000400020003000200020002000400030003000300040002000500010001000100010000000300010002000300FEFF000005000100030002000000000002000200010000000300FEFF01000100030000000200FFFF010001000500010001000100FEFF02000300FFFF0200FFFFFEFF02000400010004000000000002000100020004000200FFFF0200000001000300010001000200010001000500020003000200050002000500020005000100070001000500030003000300050003000500040004000300060004000500050003000300060005000500050001000200040005000400040002000200040004000400010001000300030004000300010003000300020004000200030003000400030005000100040004000400030003000100020005000400040002000100020005000500040003000300030006000400040002000500020005000300030004000400020002000300020003000600010004000200030001000400010003000100000000000000000001000000000000000000FFFF0100FFFF0000FFFFFFFFFDFF0000FEFFFEFFFEFFFFFFFEFF0100FFFFFEFFFFFFFCFFFEFFFFFFFDFFFDFFFDFFFAFFFDFF0000FDFFFEFFFDFFFDFFFDFF0000FEFF0000FEFFFCFFFCFFFDFFFEFF0000FEFFFFFFFDFFFFFFFDFFFDFFFEFF0000FEFFFFFFFEFFFEFFFDFF0100FCFFFEFFFDFFFCFFFEFFFDFFFEFFFBFFFEFFFFFFFFFFFFFFFFFFFDFFFFFFFBFFFFFF0100FEFFFEFFFFFFFCFF000001000000FEFFFFFFFEFF0100FEFFFFFFFFFFFEFFFFFF0000FFFFFEFF0000FFFFFEFFFFFFFFFFFEFFFDFFFEFFFDFFFEFF0000FDFF0100FDFF0000FEFFFFFFFDFF0100FEFFFDFFFDFFFEFFFDFF0100FEFFFDFFFEFFFFFFFFFF0000FEFFFEFFFDFFFEFFFFFFFDFFFDFFFEFFFDFFFDFFFFFFFBFFFDFFFDFF0000FDFFFEFFFDFFFDFFFCFFFFFFFEFFFCFFFFFFFCFFFCFFFEFFFDFFFCFFFFFFFDFFFDFFFEFFFCFFFDFFFDFFFEFFFCFFFFFFFBFFFFFFFCFFFFFFFBFFFEFFFCFFFEFFFDFFFEFFFCFFFCFFFDFFFDFFFEFFFDFFFCFFFDFFFCFFFEFFFDFFFEFFFCFFFDFFFCFFFEFFFDFFFDFFFBFFFDFFFBFFFDFFFDFFFCFFFDFFFDFFFBFFFEFFFCFFFCFFFDFFFCFFF8FFFDFFF9FFFCFFFCFFFBFFFBFFFBFFFAFFFBFFFDFFFAFFFCFFFBFFFBFFFCFFFBFFFCFFFAFFFDFFF9FFFDFFFBFFFCFFFAFFFCFFFBFFFAFFFCFFFBFFFBFFFCFFFBFFFCFFFDFFFDFFFEFFFBFFFBFFFBFFFBFFFDFFFDFFFEFFFBFFFBFFF9FFFDFFFCFFFDFFFDFFFEFFFAFFFDFFFBFFFCFFFDFFFDFFF9FFFCFFFCFFFCFFFDFFFCFFFBFFFBFFFCFFFCFFFCFFFDFFFAFFFBFFFAFFFCFFFDFFFCFFFBFFFDFFF8FFFDFFFDFFFCFFFBFFFDFFF8FFFEFFFDFFFEFFFEFFFDFFFAFFFCFFFCFFFDFF0000FBFFFCFFFEFFFCFFFDFFFCFFFCFFF8FFFCFFF9FFFCFFFCFFFCFFFBFFFBFFFAFFFBFFFEFFFBFFFCFFFCFFFCFFFCFFFDFFFCFFFCFFFDFFFAFFFEFFFCFFFDFFFDFFFDFFFBFFFCFFFBFFFCFFFCFFFCFFFCFFFCFFFDFFFCFFFDFFFBFFFEFFFCFF0200FDFFFEFFFCFFFEFFFEFFFCFFFFFFFCFFFDFFFDFFFCFFFCFFFDFFFFFFFCFFFEFFFBFFFDFFFDFFFDFFFCFFFEFFFDFFFCFFFFFFFCFFFCFF0000FDFFFFFFFEFFFDFFFCFFFDFFFDFFFFFFFDFFFDFFFCFFFBFFFCFFFBFFFEFFFCFFFEFFF9FFFDFFFAFFFDFFFFFFFFFFFBFFFCFFFCFFFDFF0000FFFFFDFFFBFFFDFFFEFFFFFFFEFFFBFFFCFFF9FF0000FFFFFFFFFDFFFFFFFCFFFFFF0100FEFF01000000FEFFFFFFFEFFFFFFFFFF0000FEFFFFFFFFFF0200010002000100FEFF020000000300010003000000FEFF0300020002000500010002000400010002000200010003000300020001000300020005000300030002000400030004000300010003000000040003000300030005000600030004000300050006000600010002000200020003000400020006000400040003000500040004000400000002000100030001000300010002000200020003000100030000000400000004000000040000000300020002000200010002000000010000000100FFFF01000200010001000100FFFF01000300010002000000FFFF01000000FFFF01000000FFFF03000000000001000200FFFF02000100000002000200000002000200010002000200FFFF0200FDFF02000000010000000200FDFF02000100020002000300FEFF030000000300040003000100030002000400050003000200050001000300050004000300060001000600040006000200060002000600050006000400070001000500010005000100050004000400020004000000040004000400040003000000020002000400030005000200040002000400020002000100020002000500040002000300040004000500020002000000040000000300FEFF0300020004000200030000000300000003000200020001000300FEFF03000200020000000300FBFF0200FEFF000002000100FFFF01000000010004000100000001000000010004000200FFFF0100FFFF010001000200010002000000000000000200000002000000000002000100FFFF02000100010001000100FFFF000000000000FEFF0200FDFFFFFF01000100FEFF02000000FFFF00000000FDFF020000000100FDFF0000FEFF00000000FFFF0000FFFF0000FFFF010000000000010000000200000002000100030002000200FFFF0200010001000000FEFFFDFFFFFF000000000000FEFFFEFFFFFFFEFF010000000000000000000000010000000000FFFF0000FFFF0100FFFF0100FEFF010001000100FFFF020000000100010001000300020004000200050001000500010005000200050001000000030000000300010002000000010002000200010002000100010004000200040001000100020004000300010000000000010001000100FFFFFFFFFEFF01000000010003000000FDFF0000FFFFFFFF05000000FFFF0000FEFF000003000100FFFFFFFF0000FFFF0000FFFF0200FFFFFFFF00000200FEFF0100FDFF010000000100FFFF00000000FEFF0000FCFFFFFF06000100FEFF0000FBFF01000500000003000000FDFF02000800FFFF02000000FEFF00000500000000000100FFFF02000300030001000200010003000300030003000200040004000300030002000300050002000200020001000300050003000100030003000400040003000300020004000200060002000300040004000300040002000400020002000200010001000400030003000100030001000400030001000200010003000300020001000400000003000200010002000300010001000300020002000200010001000200010001000100020002000200040002000000010003000300030002000000000003000200030002000100FFFF04000100030002000100010004000100020004000200020004000200020003000100010002000100020002000100010003000100030003000200020004000200030004000200010003000400030006000300030003000500020005000300030004000400030008000500040004000300030005000500030003000100040002000600000003000100050003000500FFFF02000200040005000500010004000200040006000500FFFF04000200050004000500FFFF04000200030004000400010004000200040007000400030004000400060007000300030004000400070005000400040004000400040004000400040004000300040004000500040004000400030004000400000004000100040003000400FEFF03000200030003000200FFFF0200FFFF020002000100FFFF010005000200FAFF0000FDFF00000A00FEFFF6FFFEFFF7FFFEFF0500FFFFFAFFFFFFF8FFFEFF02000000FFFFFFFFF9FFFCFFFBFFFFFFFCFFFEFFFCFFFCFFF9FFFFFFF9FFFCFFFEFFFCFFF9FFFDFFF8FFFBFFFCFFFDFFFBFFFCFFFBFFFBFFFCFFFDFFFBFFFCFFFAFFFBFFFCFFFEFFFAFFFDFFFAFFFCFFFCFFFFFFFDFFFEFFFCFFFDFFFDFFFEFFFDFFFDFFFDFFFDFFFDFFFFFFFEFFFEFFFFFFFDFFFDFFFFFF0000FEFF0000FEFFFDFFFFFFFCFFFEFFFDFFFFFFFBFFFFFFFBFFFDFFFCFFFDFFFCFFFEFFFBFFFDFFFDFFFDFFFCFFFDFFFBFFFDFFFBFFFDFFFBFFFCFFFAFFFCFFFAFFFDFFFBFFFCFFFBFFFBFFFAFFFBFFFCFFFCFFFEFFFCFFFDFFFCFFF9FFFDFFFEFFFDFFFEFFFDFFFAFFFFFF0000FDFF0100FEFFFCFFFEFF0100FEFF02000100FDFFFEFF0100000002000100FEFF0000020000000200FFFFFEFFFFFFFFFF000001000000FCFFFFFFFDFFFFFFFEFFFFFFFBFFFFFFFDFFFFFFFFFFFFFFFCFFFEFFFCFF0000FDFFFDFFFCFFFDFFFDFFFEFFFEFFFCFFFDFFFCFFFCFFFDFFFDFFFCFFFCFFFDFFFAFFFBFFFAFFFBFFFBFFFCFFF9FFFBFFFBFFFCFFFAFFFBFFF8FFFAFFF9FFFCFFF9FFFBFFF8FFFBFFFAFFFDFFFDFFFAFFFAFFFAFFFCFFFBFFFFFFFAFFFAFFFBFFF9FFFAFFFBFFFBFFFAFFFDFFFAFFFCFFFCFFFCFFFAFFFCFFFAFFFCFFFDFFFCFFFDFFFCFFFDFFFCFFFEFFFCFFFCFFFBFFFEFFFBFFFEFFFBFFFEFFFAFFFCFFFAFFFEFFFBFFFFFFFBFFFDFFFCFFFEFFFBFFFCFFFBFFFAFFFAFFFAFFFBFFFEFFFCFFFCFFFAFFFAFFFCFFFEFFFBFFFCFFFAFFFBFFFDFFFCFFFDFFFCFFFDFFFDFFFCFFFDFFFCFFFCFFFDFFFDFFFDFFFCFFFDFFFEFFFCFFFEFFFCFFFDFFFCFFFCFFFDFFFCFFFDFFFEFFFCFFFBFFFDFFFDFFFCFFFEFFFCFFFCFFFEFFFCFFFCFFFFFFFCFFFCFFFEFFFCFFFCFFFFFFFDFFFCFFFEFFFDFFFCFFFDFFFCFFFEFFFDFFFBFFFCFFFEFFFBFFFFFFFBFFFFFFFBFFFDFFFBFFFEFFFBFFFDFFFBFFFCFFFCFFFDFFFBFFFCFFFCFFF9FFFCFFFBFFFBFFFCFFFDFFFBFFFBFFFAFFFAFFF9FFFCFF0300FBFFF8FFFBFFF9FFFAFFFFFFFDFFF9FFFCFFF7FFFBFFFEFFFDFFFCFFFDFFF9FFFBFFFCFFFCFFFAFFFFFFF9FFFEFF0000FFFF0000FFFFFCFFFFFF0200FFFF010000000100FFFF0200FFFF0200FFFF03000100FFFF02000100010002000200FEFF03000000000001000200000003000200FFFF02000200010001000200FFFF01000100FEFF00000200000001000000FEFF0100000000000400000000000100FEFF010004000000FEFFFFFFFFFFFFFF0200FFFFFFFF0000FFFFFEFFFFFFFFFFFDFFFFFFFCFF000000000000FCFFFEFFFEFF01000100FFFFFEFFFFFFFDFF000000000000FEFFFFFFFDFFFFFF0000FFFF0100FEFFFFFFFEFF0000FFFF0000FFFFFFFFFEFF01000000FFFFFFFFFCFFFFFFFEFF0000FDFFFEFFFBFFFFFFFDFFFFFF0200FEFFFDFFFDFF0000FDFF0100FEFFFEFFFDFF0000FDFFFDFFFFFFFBFFFCFFFEFFFFFFFFFFFFFFFDFFFEFFFFFFFFFF0000FCFFFDFFFEFFFEFFFFFFFFFFFDFFFCFFFFFFFFFFFFFF0100FDFF00000000FFFFFFFF0000FCFF02000000FFFFFEFF0000FEFF020001000100FFFFFDFFFEFF010000000400FFFFFEFFFFFF0200000003000000010000000000000000000000020002000400010002000100040001000600010004000200040002000500010003000300020003000300000004000400040002000300020004000300040002000400020004000300050003000400020003000100060004000400040003000200040004000200040003000100050004000200020002000100040004000200010002000100020003000100010005000100010002000000FFFF030001000000FFFF0000FFFF04000100FFFFFEFFFFFFFEFF0200FFFFFFFFFDFFFEFF01000100FEFF0000FDFFFDFF01000100FDFF0000FEFFFCFFFFFFFEFFFCFF0100FFFFFFFFFFFFFDFFFEFF0000FEFFFFFFFEFFFDFFFFFF0000FFFFFFFFFFFFFDFF00000000FFFF0300FFFF0200FFFFFDFFFFFF0000FEFFFFFFFFFFFDFFFFFF0000FFFF0000FEFFFFFFFFFF0000000000000000FFFF000001000200010000000000FFFF0100000001000100FFFFFFFFFDFF0100FFFFFFFFFFFFFFFFFEFF00000100FDFF0100FEFFFFFF00000100FDFFFFFFFEFFFEFF0000FFFFFFFFFEFF000000000100FFFFFFFFFFFF01000100010000000000FFFF0200FFFF0200FFFF0100FDFF010000000100030000000100000001000200010000000200010000000100FEFFFEFF0100010000000100FFFFFFFF00000100020000000100FFFF010001000100FFFF01000000020001000000FEFFFFFFFFFF0100FFFFFDFFFFFFFEFFFEFF0100FFFFFEFFFFFFFDFFFEFFFFFFFFFFFFFFFEFFFDFFFEFFFFFFFFFFFCFFFDFFFDFFFEFFFCFFFDFFFEFFFBFFFDFFFEFFFCFFFEFFFFFFFCFF0000FFFFFDFFFEFF0100FDFFFFFFFFFFFEFFFEFFFFFFFEFFFDFFFFFFFEFFFFFF0000FDFFFEFFFEFFFFFF00000100FEFFFFFFFFFFFFFFFFFFFDFFFDFFFFFFFFFF0000FFFFFBFF0000FFFF01000100FEFFFDFF0000000000000300FFFFFFFF02000200000001000100FFFF020001000000010002000200020003000100030001000300020005000100030002000100010003000200030001000000020001000000FFFF01000000020001000000FEFF01000000000003000000FFFF03000000000002000200FEFF02000200000002000200FFFF00000200FFFF030001000000FEFF0000FFFF01000100FEFF0000FEFF010001000100FFFF0100FEFF00000000010000000100FEFF00000100FFFF00000100FEFF00000100010000000000FDFF00000100000000000000FCFFFFFFFFFFFFFFFEFFFFFFFDFFFEFFFFFFFFFFFEFFFDFFFDFFFDFF0000FFFFFDFFFEFFFEFFFFFFFEFFFFFFFCFFFDFFFCFF0100FBFFFFFFFEFFFEFFFCFF0000FAFFFFFF0000FDFFFFFFFFFFFBFFFDFFFFFFFDFFFFFF0000FBFFFDFFFEFFFFFFFEFFFFFFF9FFFEFFFDFF0000FFFFFFFFF9FFFEFFFDFFFFFFFEFFFEFFFCFFFDFFFFFFFFFFFEFFFEFFFCFFFEFFFEFF0000FDFFFEFFFCFFFFFFFBFF00000000FFFFFDFF0000FCFF010004000000FAFF0100FDFF01000200FFFFFCFF0200FCFF010000000000FBFF0300FDFF000002000200FEFF0300FCFFFFFF0400020001000100FCFFFFFF0300010001000100FEFF00000100010002000100FDFF0000FFFF010001000200FFFF0000010001000100020000000100FFFF0100FFFF0000FEFF000001000100FFFF0000FFFF0000FFFF0100FCFF010000000000FDFF0100FEFF0200FEFF0000FCFF0200FFFF0000FEFFFFFFFEFF0100FEFFFFFFFDFF0000FEFF0100FCFF000000000200FBFF0100FCFFFFFF02000200FCFF0100FEFF000001000100FFFF020001000100FFFF0000FCFF0200FEFF010000000200FCFF0200FDFF020003000200FCFF0200FDFF020002000200FCFF0300FEFF0100FFFF0000FEFF0100FDFF0100FEFF0100FDFF0000F9FF010002000200FFFF0000FCFF010000000300FEFF0100FDFF0100FFFF0300FEFF0100FEFF03000000020000000100FFFF04000000020001000200010003000100030000000400030002000100030003000300040002000000030001000200010003000500030000000200010003000500020002000300010003000400020002000200FEFF030003000000020002000200030005000000020003000100010000000200FFFF02000100000001000200010001000000000001000100010001000100FFFF0200000000000000FFFF000001000200FFFFFFFFFEFF000001000000FEFF0000FDFF010002000000FFFF0000FFFF01000400FFFFFFFF00000000010005000100FFFFFFFF0000020002000000FEFFFFFF010002000000FFFFFFFF0300030000000200FFFFFFFF0200040001000300010000000000030001000400000000000100020001000200000001000200040000000100FFFF03000200050000000400000003000300030002000700010005000300040004000600020004000400030003000600020004000500020003000900010007000400030004000600020005000400030004000500030005000500040003000800040005000300040002000800020005000300050002000700030004000300040003000500050005000400060004000700050003000300060002000600040003000300070002000600040007000200080004000600040007000100060003000400030006000100060002000200030005000200040003000400030004000300010003000400000004000100FFFF0200020000000500020002000300030001000200030002000300020001000100050000000300030001000300030004000200020002000400020002000200FFFF01000200030001000200FFFF0300010005000600040002000400030005000700030005000300040004000900030004000300FFFF03000800050006000300FEFF03000500050006000300FDFF0500030005000700030001000400010002000700010000000200FFFF03000500020002000300010002000300000006000300FFFF0200FFFF010004000300010002000200000004000200FFFF0000FFFF000002000100FFFFFFFFFEFF0000040002000100FFFFFEFF0100020003000000FFFF0000010001000100FCFFFEFFFBFFFFFF010001000100FFFFFDFFFFFF0100020003000000FBFF00000000010001000000FDFF0000FFFF00000300000001000000FDFF01000200000002000000FEFFFFFFFFFFFFFF01000200FFFFFFFFFEFF0000FFFF00000000FFFFFEFF02000100FEFF01000000FFFF0000FEFFFFFF0000FFFFFCFF0000FBFF00000400FFFF00000100FAFFFFFF0200010002000100FFFFFEFFFFFF0000FEFF00000000FFFFFDFF0100FCFFFFFFFDFF0100FEFF0000FEFF0000030001000000000000000000FEFF0200FBFF010002000000FEFF0200FDFF030004000000FFFFFFFFFBFF010002000000FEFF0000FCFF01000400FFFF00000000FDFF0000FFFFFEFFFEFF0000FDFFFFFFFCFFFEFFFFFFFFFFFEFFFFFFFCFFFDFFFBFFFEFFFEFFFDFFFFFFFCFFFBFFFDFFFFFFFCFFFAFFFDFFFBFFFCFFFBFFFDFFFCFFFDFFFDFFFBFFFAFFFCFFF9FFFCFFFEFFF9FFF9FFFAFFF5FFFBFFFDFFF8FFF9FFFBFFF6FFFAFFFAFFF9FFFCFFFCFFF8FFF8FFF9FFF9FFFCFFFCFFF6FFF9FFF5FFFAFFFDFFFCFFF6FFFAFFF4FFF9FFFEFFFDFFF8FFFAFFF3FFFBFFFAFFFCFFF7FFFAFFF2FFFBFFFBFFFFFFFEFFFBFFF7FFFBFFFAFFFFFFFEFFFCFFF6FFFAFFFAFFFDFF0100FCFFFEFFFBFFF5FF0000FFFFFEFF0000FBFFF7FFFEFFFBFFFDFF0000FCFFFCFFFEFFF7FFFEFF0000FEFFFFFFFCFFF8FFFCFFFEFFFFFFFCFFFDFFF5FFFDFFFCFF0000FBFFFCFFF8FFFDFFFDFFFDFFFCFFFCFFFAFFFDFFFCFFFDFFF9FFFCFFFBFFFDFFFAFFFBFFF7FFFCFFFCFFFEFFFCFFFBFFF4FFFDFFF9FFFCFF0000FCFFF5FFFDFFF9FFFBFF0000FAFFF6FFFDFFF7FFFBFFFFFFFBFFF9FFFCFFF8FFFCFFFEFFFDFFF9FFFCFFF9FFFCFFFCFFFCFFFBFFFEFFF7FFFDFFFAFFFCFFFCFFFDFFFBFFFDFFF9FFFBFFFCFFFBFFFDFFFBFFFCFFFBFFFDFFFDFFFBFFFCFFF6FFFAFFFAFFFDFFFBFFFCFFF8FFFAFFFAFFFCFFF9FFFBFFFCFFFCFFFBFFFDFFF9FFFCFFFAFFFEFFFFFFFCFFFBFFFAFFF9FFFBFFFDFFFAFFFBFFF8FFFAFFFBFFFDFFFCFFFCFFFAFFFCFFFBFFFCFFFBFFF6FFFBFFF4FFFAFFFAFFFAFFFBFFFAFFF8FFFAFFF7FFF9FFF6FFF9FFFBFFFAFFF7FFF7FFF5FFFAFFFCFFFBFFF9FFFAFFF5FFFCFFF9FFFAFFF8FFFBFFF8FFFDFFF8FFFBFFF8FFFCFFFAFFFCFFFCFFFCFFFAFFFDFFFBFFFDFFFEFFFCFFF6FFFEFFFBFFFDFFFEFFFDFFFCFFFFFFFDFFFEFFFEFFFCFFFDFF0000FDFFFEFFFDFFFEFFFCFF0000FDFFFFFFFAFF0000FEFFFFFFFFFFFEFFFAFF00000000FFFF0000FEFFFAFF000000000000FFFFFEFFFDFF0100FDFFFFFFFEFF0000FCFF01000000FFFFFBFF0100F9FFFEFF0200FDFFF9FFFFFFFBFFFFFF0000FEFFFDFFFFFFFAFFFFFF01000000FFFFFFFFF3FFFFFFFFFF00000500FEFFF2FF01000000000005000000F5FF0100FDFF000001000100F7FF0100F9FFFFFFFFFFFEFFF9FF0100FAFFFFFF0300FEFFFFFF0000FDFFFDFF0200FEFF0000FFFFFDFFFFFFFCFFFFFFFFFFFFFFFEFF0100FAFFFEFFFCFFFFFFFCFF0100F9FF0000FAFF0100FDFF01000000FFFFFCFF00000200FFFF0300FFFFF8FF0000F9FFFFFFFEFFFFFFFDFF0200FBFFFFFF0500000001000200FEFFFFFF04000200FFFF03000000010000000300FFFF02000200020002000400010002000000020007000300FEFF0200FEFF02000B000300FFFF0100FEFF00000800020006000100F9FF00000000030008000100FBFF0100FFFF010008000000FEFF01000100FFFF06000000FFFF02000300FFFF0200FFFF0000010003000000FEFF0200FFFFFFFF06000100FFFF01000100FFFF03000000FEFF0000030001000600FFFFFEFF0100010001000600FEFFFEFF0100FEFF00000500FDFF01000000FFFFFFFF0500FDFF03000000FEFF00000600FEFF04000100FEFF00000600FEFF0100FFFFFCFFFFFF020000000200FFFFFEFFFDFF010001000200FFFFFFFFFEFF00000000020000000400FFFFFFFF01000100FFFF04000100FFFF020002000000020001000000010003000100010000000200000004000100010001000400010005000200FFFF010001000200050002000200030001000500050003000600040001000500080002000800050003000400050002000900050002000400050003000A00050002000400070004000B00070001000300080004000A00070000000300070006000800060003000200050005000800030006000300070004000800040005000300060007000700050006000400060007000600040008000500050007000200050006000300090005000400040004000500090005000600050004000500050004000400040004000500040001000400030005000500030001000500040005000400040002000700040005000500050005000600040005000600050007000500050007000700050006000400060008000800050004000600060006000900080005000900070004000900070007000B00070005000800060007000900080008000700040006000C00070007000A00040005000C0008000C000A0008000500F4FF0A002000070006000700F2FF0A00190007000B000800F9FF0A001300030010000A00FBFF0A00100002000D000900FEFF07000B0003000D00080003000500090006000B00060007000600050006000A00050009000700070005000C0006000C00070005000400060006000A00050005000400060007000C00050009000300060009000C000600050004000500090009000500050005000500080009000200090006000600060009000200080005000800050007000400090005000A00050008000400090006000800040007000300050005000600030003000400060005000A00030005000500070005000D00020001000300050003000D000300FDFF0500020005000D00020001000600020004000B00000003000500010001000900020004000400020001000800040005000300010002000500030005000200030002000400030005000200020002000300030002000300040003000400030002000100010003000600030009000100030003000800020006000200030003000700020006000100030003000700020007000100000003000500020005000400FFFF020004000100070002000300020004000100050002000300FFFF03000100040001000100FEFF010000000300FFFF0200FEFFFFFFFFFF0100FFFF0400FEFFFFFFFEFF0100FFFF0300FFFF0000FEFF0000FEFF0400FEFF0000FCFFFFFFFDFF0100FDFFFEFFFCFFFFFFFCFFFFFFFBFFFEFFFBFFFEFFFCFFFEFFFAFFFCFFFAFFFEFFFAFFFCFFF9FFFDFFFAFFFFFFFBFFFCFFFAFFFCFFFBFFFEFFFBFFFBFFF6FFFBFFFAFFFCFFFAFFFBFFF8FFFAFFFAFFFCFFF8FFFAFFF8FFFAFFFBFFFBFFF9FFFCFFF9FFF9FFFAFFFAFFF8FFF9FFF9FFFAFFFAFFFAFFFAFFFAFFF9FFFDFFFBFFFBFFFAFFFAFFF9FFFBFFFBFFFCFFFAFFF9FFFAFFFBFFFAFFFEFFF9FFFBFFF9FFFCFFFAFFFDFFF9FFFAFFF9FFFAFFFAFFFEFFF9FFF9FFFBFFFAFFFBFFFCFFF8FFFBFFFAFFF9FFFAFFFAFFF7FFFFFFFBFFFAFFF9FFF9FFF7FFFEFFFAFFFDFFF9FFF9FFF9FFFBFFFAFFFCFFF9FFF9FFFAFFF8FFF9FFFDFFF8FFFBFFF9FFF8FFF7FFFCFFF8FFFBFFF7FFF9FFF6FFFAFFF7FFF8FFF6FFF8FFF6FFF7FFF5FFF6FFF5FFF8FFF6FFF6FFF5FFF7FFF6FFFAFFF5FFF7FFF5FFF7FFF6FFFAFFF5FFF8FFF5FFF7FFF6FFF9FFF4FFF9FFF5FFF8FFF4FFF9FFF4FFF8FFF5FFFAFFF5FFF8FFF4FFFAFFF5FFFCFFF4FFF5FFF5FFFAFFF5FFF9FFF5FFF3FFF5FFF7FFF4FFF9FFF4FFF6FFF3FFF6FFF6FFF9FFF5FFF7FFF4FFF4FFF7FFF8FFF4FFF4FFF4FFF3FFF6FFF7FFF3FFF5FFF5FFF3FFF5FFF7FFF5FFF5FFF5FFF6FFF7FFF8FFF7FFF7FFF6FFF6FFF7FFF7FFF6FFF9FFF8FFF8FFF6FFF7FFF7FFF9FFF6FFFBFFF4FFFAFFF7FFFAFFF4FFFBFFF7FFF9FFF8FFF9FFF5FFF9FFF9FFF9FFF8FFFAFFF6FFF9FFFAFFFAFFF6FFFCFFF8FFF9FFF9FFF9FFF6FFFBFFFAFFFCFFF7FFFAFFF8FFFBFFFBFFFFFFF8FFF9FFFAFFFAFFFAFFFEFFF8FFF9FFFBFFFCFFF9FFFFFFF8FFFBFFFAFFFEFFF7FFFEFFF8FFFCFFFAFFFEFFF9FFFCFFF9FFFEFFFBFFFEFFFCFFFAFFF9FFFCFFFBFFFCFFFCFFF8FFFAFFFBFFFBFFFCFFFAFFF9FFF7FFFBFFF9FFFBFFF9FFF9FFF7FFF8FFFAFFFBFFF8FFFBFFF9FFFAFFF9FFFBFFF7FFFBFFFAFFFCFFF9FFFAFFF6FFFCFFF9FFFCFFF7FFFAFFF6FFFAFFF8FFFDFFF7FFFEFFF7FFEEFFF9FFFCFFF8FF0300F7FFF2FFF9FFF7FFF7FFFEFFF8FFF6FFFAFFF7FFF7FFFEFFF9FFF8FFFBFFF6FFF7FFFFFFF8FFFCFFFBFFF9FFF8FFFCFFF9FFFBFFFCFFFAFFF8FFFDFFF9FFFAFFFBFFFAFFF8FFFCFFFAFFFAFFFAFFFAFFF9FFFCFFFAFFFCFFF9FFF8FFFAFFFDFFFBFFFDFFFAFFF8FFFBFFFDFFFBFFFFFFFCFFFBFFFBFFFDFFFCFFFEFFFCFFFDFFFBFFFEFFFAFFFEFFFBFFFEFFFAFFFEFFFAFFFCFFFBFFFEFFFAFFFFFFFBFFFDFFFCFFFFFFFBFF0100FDFFFEFFFDFF0000FBFF0000FCFFFCFFFCFFFDFFFCFFFFFFFCFFFEFFFEFFFEFFFDFFFFFFFBFF0000FDFFFFFFFCFFFFFFFCFF0200FDFF0000FCFFFFFFFDFF0000FCFFFFFFFCFF0000FDFF0000FFFFFDFFFCFFFFFFFEFF0200FFFFFEFFFEFF0000FEFF0000FEFFFDFFFEFFFFFFFCFFFFFFFBFFFDFFFBFFFDFFFBFFFFFFFBFFFCFFFBFFFBFFFAFFFFFFFCFFFEFFFBFFFBFFFBFFFDFFFCFFFDFFFBFFFBFFFCFFFBFFFBFFFEFFFCFFFEFFFCFFFBFFFCFFFFFFFDFFFEFFFCFFFAFFFCFFFEFFFDFF0000FDFFFFFFFDFF0100FDFF0100FCFFFFFFFDFF0200FDFF0000FEFFFFFFFEFF0200FEFF0000FEFFFFFFFFFF0100FFFF0200FEFFFEFFFFFFFFFFFEFF02000000FEFF00000000FFFF0300FFFF0100FFFF0100FEFF0300FDFF0200FFFF0200FFFF0200FFFF000000000000FEFF0100FFFF0100FFFF0200FEFF0300FFFF0200FEFF0200FFFF02000100FFFFFFFF01000000040001000300FFFF040000000400020004000100050001000400020004000100030000000200010001000000020001000000010001000100040000000200000002000200040001000200000005000100050001000300000006000100040001000400FFFF04000100040001000600FFFF06000300040001000200FFFF02000200FFFFFFFF00000000030002000200FFFF0100FFFF0500FFFF02000000020002000600000002000100020002000400000002000100010001000200FEFF0200FFFF000000000000FEFF02000000030001000100000001000100FEFF020001000200FEFF0200FEFF0200020001000000010001000100040002000300010004000200030002000100FFFF030003000300030001000200010004000500040000000400030005000500050002000200010004000400030002000100010005000500030007000400060005000400030009000300060005000300040006000500060005000700050006000500060006000600040009000500090007000600040009000600080006000700050007000700050005000600040007000700060006000700050008000500050006000400050006000400030005000200050005000500030004000100030005000400060004000300030006000300070005000500050004000500050006000700070006000500040006000800090008000600060007000A000500080006000500070008000500070007000500070007000500070007000600060006000600060008000700040006000700050008000500040005000800050007000800080007000800080006000B0009000B0008000A0008000C00090009000900090009000A000B0006000900060009000A000C0008000B00080009000C000A000C0009000A0008000B0008000A00080006000900080009000500080005000A0007000A000600090007000900070009000600080005000800080008000700080005000A00060006000600090007000A000500070007000A0008000900080007000B000B00080009000700090009000A000600080004000A0003000A00040008000300080005000900050007000400080004000800070006000500070005000700050007000400070002000900040007000200070003000800050007000500080005000800030007000500080004000800040008000400070004000600060007000600080004000600030008000200070001000700020008000200070003000600040005000300060003000500000006000100060000000500FDFF0600FCFF0600FDFF050000000600030006000200050004000600030005000100050002000500000006000000060000000500FFFF05000000060001000600000006000100060003000500050005000400050005000600040005000200040000000600FEFF0600FFFF040000000500FEFF0600010005000300030003000400020005000200040001000400FDFF05000200030001000300FDFF050000000400FFFF0300FCFF0400FEFF0200FEFF0200FFFF02000100010000000200FFFF0000FFFF0100FDFF0100FCFF0100FDFF0300FCFF0100FCFF0100FFFF0200FDFF0100FEFF01000200000000000100FCFF0000FEFF0000FEFF0100FBFF010000000100FFFF0000FBFF0000FDFF0100FEFFFFFFFBFF0000FBFF0000FDFFFFFFFCFFFDFFFDFFFDFFFDFFFDFFFCFFFDFFFCFFFDFFFBFFFDFFFAFFFEFFFAFFFEFFF8FFFEFFF8FFFEFFF8FFFDFFF9FFFCFFFCFFFEFFFAFFFCFFFBFFFBFFFEFFFDFFFAFFFCFFF9FFFBFFFAFFFDFFF8FFFBFFF8FFFCFFFBFFFDFFFAFFFBFFF9FFFDFFFAFFFCFFFCFFFCFFFAFFFEFFFAFFFDFFFDFFFCFFFCFFFEFFFBFFFDFFFDFFFCFFFBFFFFFFFAFFFCFFFBFFFCFFFAFFFEFFFAFFFDFFFDFFFFFFFEFFFDFFFDFFFDFFFDFFFEFFFCFFFCFFFCFFFEFFFBFFFDFFFDFFFDFFFAFFFFFFFAFFFDFFFBFFFEFFFDFFFEFFFCFFFBFFFAFFFCFFFAFFFCFFFDFFFCFFF9FFFBFFF8FFFBFFFBFFFBFFFAFFFBFFF9FFFCFFF9FFFAFFF9FFFBFFF8FFFBFFF7FFF9FFF7FFFAFFF9FFFBFFF7FFF9FFF8FFFAFFF9FFFAFFF8FFF8FFFBFFF9FFFBFFF9FFF9FFF8FFFCFFFAFFFBFFFAFFF9FFFAFFF9FFFBFFF9FFFBFFF7FFFCFFFBFFFAFFFAFFFBFFF8FFFAFFFBFFF9FFFAFFFAFFFAFFFAFFFBFFFCFFFDFFFBFFFDFFFAFFFDFFFCFFFCFFFCFFFBFFFBFFF9FFFCFFFBFFFCFFFBFFFDFFFCFFFCFFFDFFFBFFFAFFFCFFFCFFFAFFFCFFFBFFFAFFFCFFFCFFFAFFFCFFFDFFFEFFFCFFFEFFFBFFFEFFFEFFFFFFFCFFFEFFFDFFFCFFFDFFFDFFFDFFFCFFFDFFFDFFFDFFFFFFFEFFFEFFFFFFFFFFFEFFFFFFFCFFFFFFFEFFFFFFFCFF0100FCFF0000FDFFFEFFFBFFFDFFFDFFFEFFFCFFFEFFFBFFFCFFFEFFFFFFFCFFFDFFFCFFFCFFFCFFFEFFFAFFFDFFFAFFFBFFFBFFFDFFF9FFFBFFF9FFF8FFFAFFFAFFF9FFF8FFFAFFF8FFF8FFFAFFFBFFF8FFFAFFFBFFF9FFFCFFFAFFFAFFFAFFFBFFF9FFFCFFF9FFFAFFFAFFF7FFFAFFFBFFF9FFFAFFFBFFF9FFFBFFFCFFFAFFFFFFFDFFFCFFFCFFFDFFFCFFFEFFFEFFFCFFFCFFFFFFFEFFFFFFFDFFFEFFFDFFFEFFFEFFFFFFFDFFFEFFFEFF0100FFFFFEFFFDFFFDFFFEFF0100FFFFFFFFFCFFFCFFFEFF0100FFFF0000FDFFFFFFFEFF0200FFFF0200FDFFFFFFFEFFFEFFFEFF0400FDFFFEFF0000FAFFFEFF0100FEFF02000100FBFFFCFF0300000004000000FCFFFDFFFFFFFFFF01000000FBFFFDFFFCFF000003000000FFFFFEFFFEFF0100060001000200FEFFFFFF01000300FFFF0300FEFF000002000000FFFF0100FEFF00000100020000000300000002000000010000000100000001000000FFFFFFFF0100FFFF020000000100FEFF0200FFFF0600FEFF0100FDFF010001000500FFFF0000FFFFFEFF0000030000000100FEFFFFFFFEFF0300FFFF0100FDFFFFFFFFFF0200FFFF0200FEFF010000000100FEFFFFFFFDFFFFFFFFFFFFFFFCFF0000FEFFFFFFFFFFFFFFFDFFFFFFFFFFFEFFFEFFFEFFFCFFFDFFFEFFFDFFFFFFFDFFFCFFFCFFFDFFFEFFFEFFFDFFFCFFFDFFFDFF0000FEFFFDFFFDFFFFFFFEFF03000000FFFFFEFF0100FFFF0400FFFFFFFFFEFFFEFF00000200FFFFFEFFFEFFFDFF00000200FFFFFEFFFEFF0000FEFF0300FFFFFFFFFEFFFFFFFFFF0200FFFFFFFFFEFFFEFF0100FFFFFFFFFFFFFFFFFFFF0100FEFFFEFFFEFF0000000000000100FEFFFFFFFFFF0100FEFF0300FEFFFFFFFFFF0000FFFF0100FEFFFEFF0000FDFFFDFFFDFFFCFFFBFFFEFFFCFFFCFFFEFFFAFFFCFFFDFFFCFFFCFFFEFFFAFFFCFFFCFFFAFFFAFFFDFFF9FFFAFFFCFFF9FFFCFFFBFFFBFFFBFFFCFFFCFFFBFFFBFFFBFFFCFFFCFFFDFFFBFFFBFFFBFFFDFFFDFFFBFFFCFFFDFFFBFFFDFFFDFFFCFFFBFFFDFFFBFFFDFFFCFFFEFFFCFFFDFFFCFFFDFFFCFFFDFFFDFFFDFFFCFFFCFFFCFFFDFFFCFFFEFFFCFFFDFFFEFFFDFFFCFFFBFFFBFFFDFFFDFFFCFFFAFFFAFFFBFFFCFFFCFFFCFFFAFFFCFFFCFFFBFFFBFFFCFFFAFFFDFFFCFFFCFFFBFFFEFFFAFFFEFFFCFFFCFFFBFFFDFFFBFFFAFFFBFFFAFFFBFFFCFFFCFFFBFFFBFFFBFFFDFFFFFFFBFFFEFFFBFFFDFFFEFFFFFFFBFFFFFFFDFFFDFFFEFFFEFFFCFF0000FEFFFDFFFFFFFEFFFDFF0000FEFFFEFFFFFFFDFFFDFFFFFFFFFFFFFFFEFFFEFFFDFFFFFFFFFFFEFFFEFFFFFFFEFFFFFFFFFFFFFF00000000FFFFFFFFFEFFFEFF0000FFFFFFFFFEFFFFFFFEFF0000FFFF00000000000000000000000001000100010001000200000001000100030000000300010001000100030002000500020003000100040004000500040003000400";
    private FespxProcessor mFespxProcessor;
    private LocalSignalProcessingConfig signalConfig;
    private SignalProcessingParams mParam;
    private SpeechListenerImpl mSpeechListener;
    private volatile byte[] accessionalData;
    private Map<String, WakeupWord> mapWakeupWord = new HashMap<>();

    private AILocalSignalAndWakeupEngine() {
        signalConfig = new LocalSignalProcessingConfig();
        mParam = new SignalProcessingParams();
        mSpeechListener = new SpeechListenerImpl(null);
    }

    @Override
    public String getTag() {
        return "local_saw";
    }

    /**
     * 创建前端信号处理引擎对象
     *
     * @return AILocalSignalAndWakeupEngine  返回实例对象，可支持多实例
     */
    public static AILocalSignalAndWakeupEngine createInstance() {
        return new AILocalSignalAndWakeupEngine();
    }

    private byte[] getAccessionalData() {
        if (accessionalData == null)
            synchronized (this) {
                if (accessionalData == null)
                    accessionalData = Util.hexToByte(ACCESSIONAL_HEX);
            }
        return accessionalData;
    }

    private boolean checkLibValid() {
        if (signalConfig != null && signalConfig.isSspe())
            return Sspe.isSoValid();
        int micType = signalConfig != null && signalConfig.getMicType() >= 0 ? signalConfig.getMicType() : AISpeech.getRecoderType();
        if (signalConfig != null && signalConfig.getNearWakeupConfig() != null) {
            boolean nearFespxSo = NearFespx.isFespxSoValid();
            if (!nearFespxSo) {
                return false;
            }
        }

        switch (micType) {
            case DUILiteConfig.TYPE_COMMON_LINE4:
            case DUILiteConfig.TYPE_TINYCAP_LINE4:
            case DUILiteConfig.TYPE_TINYCAP_LINE6:
                return Fespl.isFespxSoValid();
            case DUILiteConfig.TYPE_COMMON_CIRCLE6:
            case DUILiteConfig.TYPE_COMMON_CIRCLE4:
            case DUILiteConfig.TYPE_TINYCAP_CIRCLE4:
            case DUILiteConfig.TYPE_TINYCAP_CIRCLE6:
                return Fespa.isFespxSoValid();
            case DUILiteConfig.TYPE_COMMON_FESPCAR:
            case DUILiteConfig.TYPE_COMMON_FESPCAR4:
                return fespCar.isFespxSoValid();
            case DUILiteConfig.TYPE_COMMON_DUAL:
            case DUILiteConfig.TYPE_TINYCAP_DUAL:
                return Fespd.isFespxSoValid();
            default:
                return Sspe.isSoValid();
        }
    }

    @Override
    public FespxProcessor getFespxProcessor() {
        return this.mFespxProcessor;
    }

    public void init(AILocalSignalAndWakeupConfig config, AILocalSignalAndWakeupListener listener) {
        super.init();
        parseConfig(config);
        JNIFlag.isLoadCarSspe = false;
        if (!checkLibValid() && listener != null) {
            listener.onInit(AIConstant.OPT_FAILED);
            listener.onError(new AIError(AIError.ERR_SO_INVALID, AIError.ERR_DESCRIPTION_SO_INVALID));
            Log.e(TAG, "so动态库加载失败 !");
            return;
        }
        mSpeechListener.setListener(listener);
        if (mFespxProcessor == null)
            mFespxProcessor = new FespxProcessor();
        mFespxProcessor.init(mSpeechListener, signalConfig);
        mBaseProcessor = mFespxProcessor;
    }

    private void parseConfig(AILocalSignalAndWakeupConfig config) {
        if (config == null) {
            Log.e(TAG, "AILocalSignalAndWakeupConfig is null !");
            return;
        }
        Log.d(TAG, "AILocalSignalAndWakeupConfig " + config);
        signalConfig.setUseSspe(config.isSspe());
        signalConfig.setRollBack(config.getRollBackTime());
        signalConfig.setThreshs(config.getThreshold());
        signalConfig.setThreshs2(config.getLowThreshold());
        signalConfig.setCcThreshs(config.getCcThreshold());
        signalConfig.setEnv(config.getEnv());
        signalConfig.setWakupWords(config.getWakeupWord());
        signalConfig.setSubwordWakeup(config.getSubwordWakeup());

        float[] threshHigh = config.getThreshHigh();
        if (threshHigh != null && threshHigh.length > 0) {
            String[] thresholdHigh = new String[threshHigh.length];
            for (int i = 0; i < threshHigh.length; i++) {
                thresholdHigh[i] = String.format(Locale.ENGLISH, "%.3f", threshHigh[i]);
            }
            signalConfig.setThreshHigh(thresholdHigh);
        } else {
            signalConfig.setThreshHigh(null);
        }

        float[] threshLow = config.getThreshLow();
        if (threshLow != null && threshLow.length > 0) {
            String[] thresholdLow = new String[threshLow.length];
            for (int i = 0; i < threshLow.length; i++) {
                thresholdLow[i] = String.format(Locale.ENGLISH, "%.3f", threshLow[i]);
            }
            signalConfig.setThreshLow(thresholdLow);
        } else {
            signalConfig.setThreshLow(null);
        }

        signalConfig.setCustom(config.getCustomNet());
        signalConfig.setNet(config.getEnableNet());
        signalConfig.setMajors(config.getMajors());
        signalConfig.setDchecks(config.getDcheck());
        signalConfig.setVad(config.isVad());
        signalConfig.setMaxMessageQueueSize(config.getMaxMessageQueueSize());
        parseConfigWakeupword(config.getWakeupWord(), config.getThreshold(), config.getLowThreshold(), config.getMajors(), config.getDcheck());
        signalConfig.setStateFrame(config.getStateFrame());
        signalConfig.setRightMarginFrame(config.getRightMarginFrame());
        signalConfig.setCnWakeupWord(config.getCnWakeupWord());
        signalConfig.setHighThreshold(config.getHighThreshold());
        signalConfig.setCloudWakeupCheckTimeout(config.getCloudWakeupCheckTimeout());
        signalConfig.setPreUploadRollbackTime(config.getPreUploadRollbackTime());

        //接口callback注册标记
        signalConfig.setImplMultiBfCk(config.isImplMultiBfCk());
        signalConfig.setImplWakeupCk(config.isImplWakeupCk());
        signalConfig.setImplInputCk(config.isImplInputCk());
        signalConfig.setImplOutputCk(config.isImplOutputCk());
        signalConfig.setImplEchoCk(config.isImplEchoCk());
        signalConfig.setImplEchoVoipCk(config.isImplEchoVoipCk());
        signalConfig.setImplAgcCk(config.isImplAgcCk());
        signalConfig.setImplBfCk(config.isImplBfCk());
        signalConfig.setImplDoaCk(config.isImplDoaCk());
        signalConfig.setImplSevcNoiseCk(config.isImplSevcNoiseCk());
        signalConfig.setImplVprintCutCk(config.isImplVprintCutCk());
        signalConfig.setImplSevcDoaCk(config.isImplSevcDoaCk());
        signalConfig.setImplVadCk(config.isImplVadCk());

        // resource in assets
        final List<String> resourceInAssetsList = new ArrayList<>();

        // wakeupResource
        final String wakeupResource = config.getWakeupResource();
        parseWakeupResConfig(resourceInAssetsList, wakeupResource);

        // sspeResource
        final String sspeResource = config.getSspeResource();
        if (TextUtils.isEmpty(sspeResource)) {
            Log.e(TAG, "sspeResource not found !!");
            signalConfig.setSspeBinPath(null);
        } else if (sspeResource.startsWith("/")) {
            signalConfig.setSspeBinPath(sspeResource);
        } else {
            resourceInAssetsList.add(sspeResource);
            signalConfig.setSspeBinPath(Util.getResourceDir(signalConfig.getContext()) + File.separator + sspeResource);
        }

        if (!config.isSspe()) {

            // beamformingResource
            final String beamformingResource = config.getBeamformingResource();
            if (TextUtils.isEmpty(beamformingResource)) {
                Log.e(TAG, "beamformingResource not found !!");
            } else if (beamformingResource.startsWith("/")) {
                signalConfig.setBeamformingBinPath(beamformingResource);
            } else {
                resourceInAssetsList.add(beamformingResource);
                signalConfig.setBeamformingBinPath(Util.getResourceDir(signalConfig.getContext()) + File.separator + beamformingResource);
            }

            // aecResource
            final String aecResource = config.getAecResource();
            if (TextUtils.isEmpty(aecResource)) {
                // 不设置 AEC 资源即不进行 AEC 处理
                Log.w(TAG, "aecResource not found !!");
                Log.w(TAG, "setAecBinPath OFF");
                signalConfig.setAecBinPath("OFF");
            } else if (aecResource.startsWith("/")) {
                signalConfig.setAecBinPath(aecResource);
            } else {
                resourceInAssetsList.add(aecResource);
                signalConfig.setAecBinPath(Util.getResourceDir(signalConfig.getContext()) + File.separator + aecResource);
            }

        }

        signalConfig.setMicType(config.getMicType());
        signalConfig.setEchoChannelNum(config.getEchoChannelNum());

        parseMdsResConfig(config, resourceInAssetsList);
        signalConfig.setNearWakeupConfig(config.getNearWakeupConfig());

        signalConfig.setAssetsResNames(resourceInAssetsList.toArray(new String[resourceInAssetsList.size()]));
    }

    private void parseWakeupResConfig(List<String> resourceInAssetsList, String wakeupResource) {
        if (TextUtils.isEmpty(wakeupResource)) {
            Log.e(TAG, "wakeupResource not found !!");
            Log.w(TAG, "setWakupBinPath OFF");
            signalConfig.setWakupBinPath("OFF");
        } else if (wakeupResource.startsWith("/")) {
            signalConfig.setWakupBinPath(wakeupResource);
        } else {
            resourceInAssetsList.add(wakeupResource);
            signalConfig.setWakupBinPath(Util.getResourceDir(signalConfig.getContext()) + File.separator + wakeupResource);
        }
    }

    private void parseMdsResConfig(AILocalSignalAndWakeupConfig config, List<String> resourceInAssetsList) {
        if (config.getNearWakeupConfig() != null) {
            String mdsResource = config.getNearWakeupConfig().getMdsResource();
            if (TextUtils.isEmpty(mdsResource)) {
                Log.w(TAG, "mdsResource not found !!");
            } else if (mdsResource.startsWith("/")) {
                config.getNearWakeupConfig().setMdsResource(mdsResource);
            } else {
                resourceInAssetsList.add(mdsResource);
                config.getNearWakeupConfig().setMdsResource(Util.getResourceDir(signalConfig.getContext()) + File.separator + mdsResource);
            }
        }
    }

    private void parseIntent(AILocalSignalAndWakeupIntent aiLocalSignalAndWakeupIntent) {
        if (aiLocalSignalAndWakeupIntent == null) {
            Log.e(TAG, "AILocalSignalAndWakeupIntent is null !");
            return;
        }
        super.parseIntent(aiLocalSignalAndWakeupIntent, mParam);
        Log.d(TAG, "AILocalSignalAndWakeupIntent " + aiLocalSignalAndWakeupIntent);
        mParam.setSaveAudioFilePath(aiLocalSignalAndWakeupIntent.getSaveAudioFilePath());
        mParam.setUseCustomFeed(aiLocalSignalAndWakeupIntent.isUseCustomFeed());
        mParam.setDumpAudioPath(aiLocalSignalAndWakeupIntent.getDumpWakeupAudioPath());
        mParam.setDumpTime(aiLocalSignalAndWakeupIntent.getDumpWakeupTime());
        mParam.setInputContinuousAudio(aiLocalSignalAndWakeupIntent.isInputContinuousAudio());
        mParam.setAddExtraAudioWhenFeedNotContinuousAudio(aiLocalSignalAndWakeupIntent.isAddExtraAudioWhenFeedNotContinuousAudio());
        mParam.setAutoSetDriveMode(aiLocalSignalAndWakeupIntent.isAutoSetDriveMode());
    }

    /**
     * 启动信号处理模块和唤醒引擎
     *
     * @param aiLocalSignalAndWakeupIntent 前端信号处理参数
     * @see AILocalSignalAndWakeupIntent
     */
    public void start(AILocalSignalAndWakeupIntent aiLocalSignalAndWakeupIntent) {
        super.start();
        parseIntent(aiLocalSignalAndWakeupIntent);
        if (mFespxProcessor != null) {
            mFespxProcessor.start(mParam);
        }
    }

    /**
     * 获取{@link AILocalSignalAndWakeupListener#onVprintCutDataReceived(int, byte[], int)}返回的音频通道
     * 用于设置给{@link com.aispeech.lite.vprint.VprintIntent#setAecChannelNum(int)}
     * 和{@link com.aispeech.lite.vprint.VprintIntent#setBfChannelNum(int)}
     *
     * @param param {@link AIConstant#KEY_FESPX_AEC_CHANNEL} 和 {@link AIConstant#KEY_FESPX_BF_CHANNEL}
     * @return aecChannelNum或bfChannelNum
     * 须在引擎初始化{@link AILocalSignalAndWakeupListener#onInit(int)}成功后才可以获取,若返回值为-1，则表示引擎未初始化
     */
    public int getValueOf(String param) {
        if (mFespxProcessor != null) {
            return mFespxProcessor.getValueOf(param);
        }
        return -1;
    }

    /**
     * 动态调整参数
     * <pre>{@code
     *  mEngine.setDynamicParam(new String[]{"ni hao xiao le"}, new float[]{0.45f}, new int[]{1})
     * }</pre>
     *
     * @param wakeupWord 唤醒词，参数示例：["ni hao xiao chi","xiao bu xiao bu"]
     * @param threshold  唤醒词对应的阈值，参数示例：[0.2, 0.3]
     * @param majors     是否主唤醒词，主唤醒词为1，副唤醒词为0，如 [1,0]
     */
    public void setDynamicParam(String[] wakeupWord, float[] threshold, int[] majors) {
        setDynamicParam(wakeupWord, threshold, null, majors);
    }

    /**
     * 动态调整参数
     * <pre>{@code
     *  mEngine.setDynamicParam(new String[]{"ni hao xiao le"}, new float[]{0.45f},new float[]{0.32f}, new int[]{1})
     * }</pre>
     *
     * @param wakeupWord 唤醒词，参数示例：["ni hao xiao chi","xiao bu xiao bu"]
     * @param threshold  唤醒词对应的阈值，参数示例：[0.2, 0.3]
     * @param threshold2 设置大音量场景下的唤醒阈值
     * @param majors     是否主唤醒词，主唤醒词为1，副唤醒词为0，如 [1,0]
     */
    public void setDynamicParam(String[] wakeupWord, float[] threshold, float[] threshold2, int[] majors) {
        setDynamicParam(wakeupWord, threshold, threshold2, majors, false);
    }

    /**
     * 动态设置参数
     * <pre>{@code
     *  mEngine.setDynamicParam(new String[]{"ni hao xiao le"}, new float[]{0.45f},new float[]{0.32f}, new int[]{1}, false)
     * }</pre>
     *
     * @param wakeupWord 唤醒词，参数示例：["ni hao xiao chi","xiao bu xiao bu"]
     * @param threshold  唤醒词对应的阈值，参数示例：[0.2, 0.3]
     * @param threshold2 设置大音量场景下的唤醒阈值
     * @param majors     是否主唤醒词，主唤醒词为1，副唤醒词为0，如 [1,0]
     * @param vad        内核是否使用vad功能
     */
    public void setDynamicParam(String[] wakeupWord, float[] threshold, float[] threshold2, int[] majors, boolean vad) {
        if (wakeupWord == null || wakeupWord.length == 0 || threshold == null || threshold.length == 0
                || majors == null || majors.length == 0)
            return;
        if (wakeupWord.length != threshold.length || wakeupWord.length != majors.length)
            return;
        StringBuilder sb = new StringBuilder();

        sb.append("words=");
        for (int i = 0; i < wakeupWord.length; i++) {
            sb.append(wakeupWord[i]);
            if (i < wakeupWord.length - 1)
                sb.append(",");
        }

        appendsThreshs(threshold, threshold2, sb);

        sb.append(";major=");
        for (int i = 0; i < majors.length; i++) {
            sb.append(majors[i]);
            if (i < majors.length - 1)
                sb.append(",");
        }
        sb.append(";");

        sb.append("vad=").append(vad ? "1" : "0").append(";");

        Map<String, Object> dynamicParam = new HashMap<>();
        // 动态设置唤醒env
        dynamicParam.put("env", sb.toString());
        setDynamicParam(dynamicParam);
    }

    private void appendsThreshs(float[] threshold, float[] threshold2, StringBuilder sb) {
        sb.append(";thresh=");
        for (int i = 0; i < threshold.length; i++) {
            sb.append(String.format(Locale.ENGLISH, "%.3f", threshold[i]));
            if (i < threshold.length - 1)
                sb.append(",");
        }

        if (threshold2 != null && threshold2.length > 0) {
            sb.append(";thresh2=");
            for (int i = 0; i < threshold2.length; i++) {
                sb.append(String.format(Locale.ENGLISH, "%.3f", threshold2[i]));
                if (i < threshold2.length - 1)
                    sb.append(",");
            }
        }
    }

    /**
     * 动态调整参数，可以用来设置唤醒词，阈值等
     * <pre>{@code
     *  Map envMap = new HashMap();
     *  envMap.put("words", new String[]{"ni hao xiao le"});
     *  envMap.put("thresh", new float[]{0.45f});
     *  mEngine.setDynamicParamEnv(envMap);
     * }</pre>
     * 区别于{@link AILocalSignalAndWakeupEngine#setDynamicParamEnv(Map)}  此方法仅可用于设置唤醒词和唤醒词阈值
     *
     * @param dynamicParam env 里的参数，key可以是 words thresh thresh2 major等, value 类型可以是 基础类型、字符串、数组、列表
     * @since 2.11.1
     */
    public void setDynamicParamEnv(Map<String, ?> dynamicParam) {
        if (dynamicParam == null || dynamicParam.isEmpty()) {
            Log.i(TAG, "setDynamicParamEnv: dynamicParam isEmpty ");
            return;
        }
        Iterator<String> iter = dynamicParam.keySet().iterator();
        StringBuilder envSb = new StringBuilder();
        while (iter.hasNext()) {
            String key = iter.next();
            Object obj = dynamicParam.get(key);
            String value;
            if (obj == null) {
                continue;
            } else if (obj instanceof Iterable) {
                StringBuilder sb = new StringBuilder();
                Iterator<Object> iterator = ((Iterable) obj).iterator();
                while (iterator.hasNext()) {
                    Object o = iterator.next();
                    sb.append(o);
                    if (iterator.hasNext())
                        sb.append(",");
                }
                value = sb.toString();
            } else if (obj.getClass().isArray()) {
                value = transferTypeArray(obj);
            } else {
                value = String.valueOf(obj);
            }
            envSb.append(key).append("=").append(value).append(";");
        }

        Map<String, Object> envMap = new HashMap<>();
        // 动态设置唤醒env
        envMap.put("env", envSb.toString());
        setDynamicParam(envMap);
    }

    private String transferTypeArray(Object obj) {
        String value;
        StringBuilder sb = new StringBuilder();
        int length = Array.getLength(obj);
        for (int i = 0; i < length; i++) {
            sb.append(Array.get(obj, i));
            if (i < length - 1)
                sb.append(",");
        }
        value = sb.toString();
        return value;
    }

    /**
     * 动态设置唤醒参数，可以在引擎初始化成功后动态设置
     * <pre>{@code
     *  Map<String, Object> dynamicParam = new HashMap<>();
     *  dynamicParam.put("env", "words=ni hao xiao le;thresh=0.45;major=1;");
     *  // maxVolumeState 用于设置大音量状态，需配置AEC资源。启用大音量检测功能时，在每次 feed 之前调用，0 表示非大音量，1 表示大音量
     *  dynamicParam.put("maxVolumeState", 1);
     *  //动态设置开关，1为开，0为关
     *  dynamicParam.put("wakeupSwitch", 0);
     *  dynamicParam.put("doa", 90);
     *  mEngine.setDynamicParam(dynamicParam);
     * }</pre>
     * 区别于{@link AILocalSignalAndWakeupEngine#setDynamicParam(Map)} 此方法可用于设置唤醒词和唤醒词阈值以外，还可以设置其他属性，如唤醒角度，环形开关，大音量等属性
     *
     * @param dynamicParam 动态参数, Map 类型，key 为 String 类型，可以是env ,maxVolumeState,wakeupSwitch,doa   value 类型可以是 基础类型、字符串、数组、列表
     */
    public void setDynamicParam(Map<String, ?> dynamicParam) {
        if (dynamicParam == null || dynamicParam.isEmpty()) {
            Log.i(TAG, "setDynamicParam: dynamicParam isEmpty ");
            return;
        }
        parseDynamicParamEnv(dynamicParam);

        JSONObject setJson = new JSONObject();
        Iterator<String> iter = dynamicParam.keySet().iterator();
        while (iter.hasNext()) {
            String key = iter.next();
            Object value = dynamicParam.get(key);
            try {
                if (value != null) {
                    if (value instanceof Iterable) {
                        transferTypeItera(setJson, key, (Iterable) value);
                    } else if (value.getClass().isArray()) {
                        tranferTypeArray(setJson, key, value);
                    } else {
                        setJson.put(key, value);
                    }
                }
            } catch (JSONException e) {
                e.printStackTrace();
                Log.e(TAG, "setDynamicParam key：" + key + " " + e);
            }
        }

        final String setString = setJson.toString();
        if (mFespxProcessor != null) {
            Log.i(TAG, "setDynamicParam: " + setString);
            mFespxProcessor.set(setString);
        }
    }

    private void transferTypeItera(JSONObject setJson, String key, Iterable<Object> value) throws JSONException {
        JSONArray jsonArray = new JSONArray();
        for (Object o : value) {
            jsonArray.put(o);
        }
        setJson.put(key, jsonArray);
    }

    private void tranferTypeArray(JSONObject setJson, String key, Object value) throws JSONException {
        JSONArray jsonArray = new JSONArray();
        int length = Array.getLength(value);
        for (int i = 0; i < length; i++) {
            jsonArray.put(Array.get(value, i));
        }
        setJson.put(key, jsonArray);
    }

    public void setDynamicParam(String json) {
        if (mFespxProcessor != null) {
            Log.i(TAG, "setDynamicParam: " + json);
            mFespxProcessor.set(json);
        }
    }

    /**
     * 获取 驾驶模式，只有车载双麦模块有这个功能
     *
     * @return 0为定位模式, 按照声源定位;1为主驾模式;2为副驾模式;3为全车模式，-1 错误，没有获取到
     */
    public synchronized int getDriveMode() {
        return mFespxProcessor != null ? mFespxProcessor.getDriveMode() : -1;
    }

    /**
     * 获取vprintcut回调输出tlv数据包长度，资源需要带声纹。
     * 每次输出时该长度固定，输入声纹时也需要保持该长度
     *
     * @return vprintcut回调 tlv数据包长度, 小于0 表示获取失败
     */
    public int getVpCallbackLength() {
        return mFespxProcessor != null ? mFespxProcessor.getFespx("vpCbLen") : -1;
    }

    /**
     * 停止信号处理模块和唤醒引擎
     * 该方法会停止接收录音数据和停止信号处理，唤醒，程序退出时可以调用
     */
    public void stop() {
        super.stop();
        if (mFespxProcessor != null) {
            mFespxProcessor.stop();
        }
    }

    /**
     * 强制请求唤醒结果，即使没有唤醒也会给出唤醒词为null的结果
     */
    public void forceRequestWakeupResult() {
        if (mFespxProcessor != null) {
            mFespxProcessor.forceRequestWakeupResult();
        }
    }

    /**
     * 销毁信号处理模块和唤醒引擎
     * 该方法会停止录音机和销毁录音机
     */
    public synchronized void destroy() {
        super.destroy();
        if (mFespxProcessor != null) {
            mFespxProcessor.release();
            mFespxProcessor = null;
        }
        if (mSpeechListener != null) {
            mSpeechListener.setListener(null);
            mSpeechListener = null;
        }
    }

    /**
     * 传入数据,在不使用SDK录音机时调用
     *
     * @param data 音频数据流
     * @param size 数据大小
     * @see com.aispeech.export.intent.AILocalSignalAndWakeupIntent#setUseCustomFeed(boolean)
     */
    public void feedData(byte[] data, int size) {
        if (mParam != null && !mParam.isUseCustomFeed())
            return;

        boolean isAddExtraAudio = mParam != null && !mParam.isInputContinuousAudio() && mParam.isAddExtraAudioWhenFeedNotContinuousAudio();
        int micType = signalConfig != null && signalConfig.getMicType() >= 0 ? signalConfig.getMicType() : AISpeech.getRecoderType();
        if (isAddExtraAudio && micType == DUILiteConfig.TYPE_COMMON_DUAL) {
            int accessionalSize = getAccessionalData().length;
            byte[] revisedData = new byte[data.length + accessionalSize];
            System.arraycopy(data, 0, revisedData, 0, data.length);
            System.arraycopy(getAccessionalData(), 0, revisedData, data.length, accessionalSize);

            if (mFespxProcessor != null) {
                Log.i(TAG, "revisedData: " + revisedData.length);
                mFespxProcessor.feedData(revisedData, revisedData.length);
            }
        } else {
            if (mFespxProcessor != null) {
                mFespxProcessor.feedData(data, size);
            }
        }
    }

    public synchronized void addOrUpdateWakeupword(List<WakeupWord> wakeupWords) {
        if (wakeupWords == null || wakeupWords.isEmpty())
            return;
        addOrUpdateWakeupword(wakeupWords.toArray(new WakeupWord[wakeupWords.size()]));
    }

    /**
     * 动态更新唤醒词
     * <pre>{@code
     * mEngine.addOrUpdateWakeupword(new WakeupWord("xiao bu xiao bu", 0.49f, 0.21f, 0, 0),
     *                         new WakeupWord("xiao la hao ke", 0.38f, 0, 1, 0));}</pre>
     *
     * @param wakeupWord 增加或者更改的唤醒词
     */
    public synchronized void addOrUpdateWakeupword(WakeupWord... wakeupWord) {
        if (wakeupWord == null || wakeupWord.length == 0)
            return;
        for (WakeupWord w : wakeupWord) {
            if (w.isValid())
                mapWakeupWord.put(w.getWakeupWord(), w);
        }
        setDynamicWord();
    }

    public synchronized void removeWakeupword(List<WakeupWord> wakeupWords) {
        if (wakeupWords == null || wakeupWords.isEmpty())
            return;
        removeWakeupword(wakeupWords.toArray(new WakeupWord[wakeupWords.size()]));
    }

    /**
     * 移除唤醒词
     * <pre>{@code
     * mEngine.removeWakeupword(new WakeupWord("xiao bu xiao bu", 0.49f, 0.21f, 0, 0));
     * mEngine.removeWakeupword("xiao bu xiao bu");
     * }</pre>
     *
     * @param wakeupWord 移除的唤醒词
     */
    public synchronized void removeWakeupword(WakeupWord... wakeupWord) {
        if (wakeupWord == null || wakeupWord.length == 0)
            return;
        if (wakeupWord.length == mapWakeupWord.size()) {
            Log.d(TAG, "removeWakeupword() delete all not allowed");
            return;
        }
        for (WakeupWord w : wakeupWord) {
            if (w.isValid())
                mapWakeupWord.remove(w.getWakeupWord());
        }
        setDynamicWord();
    }

    public synchronized void removeWakeupword(String... wakeupWord) {
        if (wakeupWord == null || wakeupWord.length == 0)
            return;
        if (wakeupWord.length == mapWakeupWord.size()) {
            Log.d(TAG, "removeWakeupword()2 delete all not allowed");
            return;
        }
        for (String s : wakeupWord) {
            if (!TextUtils.isEmpty(s))
                mapWakeupWord.remove(s);
        }
        setDynamicWord();
    }

    public synchronized WakeupWord[] getWakeupword() {
        return mapWakeupWord.values().toArray(new WakeupWord[mapWakeupWord.size()]);
    }

    public synchronized void setWakeupword(List<WakeupWord> wakeupWords) {
        if (wakeupWords == null || wakeupWords.isEmpty())
            return;
        setWakeupword(wakeupWords.toArray(new WakeupWord[wakeupWords.size()]));
    }

    /**
     * 动态设置唤醒词
     * <pre>{@code
     *  mEngine.setWakeupword(new WakeupWord("xiao bu xiao bu", 0.49f, 0.21f, 0, 0),
     *                         new WakeupWord("xiao la hao ke", 0.38f, 0, 1, 0));
     * }</pre>
     *
     * @param wakeupWord 唤醒词，包括唤醒词，阈值，major等属性
     */
    public synchronized void setWakeupword(WakeupWord... wakeupWord) {
        if (wakeupWord == null || wakeupWord.length == 0)
            return;
        mapWakeupWord.clear();
        for (WakeupWord w : wakeupWord) {
            if (w.isValid())
                mapWakeupWord.put(w.getWakeupWord(), w);
        }
        setDynamicWord();
    }

    public synchronized Collection<WakeupWord> getWakeupwordList() {
        return mapWakeupWord.values();
    }

    private synchronized void setDynamicWord() {
        if (mapWakeupWord.isEmpty()) {
            Log.d(TAG, "setDynamicWord() mapWakeupWord is empty");
            return;
        }

        Iterator<String> iter = mapWakeupWord.keySet().iterator();
        StringBuilder sbWord = new StringBuilder();
        StringBuilder sbThreshold = new StringBuilder();
        StringBuilder sbLowThreshold = new StringBuilder();
        StringBuilder sbMajor = new StringBuilder();
        StringBuilder sbDcheck = new StringBuilder();
        while (iter.hasNext()) {
            String s = iter.next();
            WakeupWord wakeupWord = mapWakeupWord.get(s);

            sbWord.append(wakeupWord.getWakeupWord());
            sbThreshold.append(wakeupWord.getThreshold());
            sbLowThreshold.append(wakeupWord.getLowThreshold());
            sbMajor.append(wakeupWord.getMajor());
            sbDcheck.append(wakeupWord.getDcheck());
            if (iter.hasNext()) {
                sbWord.append(",");
                sbThreshold.append(",");
                sbLowThreshold.append(",");
                sbMajor.append(",");
                sbDcheck.append(",");
            }
        }

        StringBuilder sb = new StringBuilder();
        sb.append("words=").append(sbWord.toString())
                .append(";thresh=").append(sbThreshold.toString())
                .append(";thresh2=").append(sbLowThreshold.toString())
                .append(";major=").append(sbMajor.toString())
                .append(";dcheck=").append(sbDcheck.toString()).append(";");

        // 动态设置唤醒env
        JSONObject setJson = new JSONObject();
        try {
            setJson.put("env", sb.toString());
        } catch (JSONException e) {
            e.printStackTrace();
        }
        if (mFespxProcessor != null)
            mFespxProcessor.set(setJson.toString());
    }

    private synchronized void parseDynamicParamEnv(Map<String, ?> dynamicParam) {
        if (dynamicParam == null || dynamicParam.get("env") == null)
            return;
        final String env = dynamicParam.get("env").toString();
        if (TextUtils.isEmpty(env))
            return;
        Log.d(TAG, "parseDynamicParamEnv() env " + env);
        String[] wakeupWord = null;
        String[] threshold = new String[0];
        String[] lowThreshold = new String[0];
        String[] major = new String[0];
        String[] dcheck = new String[0];

        String[] list = env.split(";");
        for (String s : list) {
            if (s.contains("words") && s.contains("=")) {
                wakeupWord = calWakeupWords(s);
            } else if (s.contains("thresh") && s.contains("=")) {
                threshold = s.split("=")[1].trim().split(",");
            } else if (s.contains("thresh2") && s.contains("=")) {
                lowThreshold = s.split("=")[1].trim().split(",");
            } else if (s.contains("major") && s.contains("=")) {
                major = s.split("=")[1].trim().split(",");
            } else if (s.contains("dcheck") && s.contains("=")) {
                dcheck = s.split("=")[1].trim().split(",");
            }
        }
        calWakeupMaps(wakeupWord, threshold, lowThreshold, major, dcheck);
    }

    private void calWakeupMaps(String[] wakeupWord, String[] threshold, String[] lowThreshold, String[] major, String[] dcheck) {
        if (wakeupWord == null || wakeupWord.length == 0)
            return;

        mapWakeupWord.clear();
        for (int i = 0; i < wakeupWord.length; i++) {
            float t = 0;
            float t2 = 0;
            int m = 0;
            int d = 0;
            t = calThreshold(threshold, i, t);

            t2 = calThreshold(lowThreshold, i, t2);

            m = calMajor(major, i, m);

            d = calMajor(dcheck, i, d);

            WakeupWord wd = new WakeupWord(wakeupWord[i], t, t2, m, d);
            mapWakeupWord.put(wakeupWord[i], wd);
            Log.d(TAG, "parseDynamicParamEnv() " + wd);
        }
    }

    private String[] calWakeupWords(String s) {
        String[] wakeupWord;
        List<String> listWords = Arrays.asList(s.split("=")[1].trim().split(","));
        for (int i = listWords.size() - 1; i >= 0; i--) {
            String w1 = listWords.get(i);
            if (w1.replace(" ", "").length() == 0) {
                listWords.remove(w1);
            }
        }
        wakeupWord = new String[listWords.size()];
        listWords.toArray(wakeupWord);
        return wakeupWord;
    }

    private int calMajor(String[] major, int i, int m) {
        try {
            m = major.length > i ? Integer.parseInt(major[i].trim()) : 0;
        } catch (Exception e) {
            //do nothing
        }
        return m;
    }

    private float calThreshold(String[] threshold, int i, float t) {
        try {
            t = threshold.length > i ? Float.parseFloat(threshold[i].trim()) : 0f;
        } catch (Exception e) {
            //do nothing
        }
        return t;
    }

    private synchronized void parseConfigWakeupword(String[] wakeupWord, float[] threshold, float[] lowThreshold, int[] major, int[] dcheck) {
        if (wakeupWord == null || wakeupWord.length == 0)
            return;

        if (threshold == null)
            threshold = new float[0];
        if (lowThreshold == null)
            lowThreshold = new float[0];
        if (major == null)
            major = new int[0];
        if (dcheck == null)
            dcheck = new int[0];

        mapWakeupWord.clear();
        for (int i = 0; i < wakeupWord.length; i++) {
            float t = threshold.length > i ? threshold[i] : 0f;
            float t2 = lowThreshold.length > i ? lowThreshold[i] : 0f;
            int m = major.length > i ? major[i] : 0;
            int d = dcheck.length > i ? dcheck[i] : 0;

            WakeupWord wd = new WakeupWord(wakeupWord[i], t, t2, m, d);
            mapWakeupWord.put(wakeupWord[i], wd);
            Log.d(TAG, "parseConfigWakeupword: " + wd);
        }
    }

    public void resetDriveMode() {
        if (mFespxProcessor != null)
            mFespxProcessor.resetDriveMode();
    }

    /**
     * The adapter for convert SpeechListener to AILocalSignalAndWakeupListener.
     */
    private class SpeechListenerImpl extends SpeechListener {
        AILocalSignalAndWakeupListener mListener;

        public SpeechListenerImpl(AILocalSignalAndWakeupListener listener) {
            mListener = listener;
        }

        public void setListener(AILocalSignalAndWakeupListener listener) {
            mListener = listener;
        }

        @Override
        public void onError(AIError error) {
            if (mListener != null) {
                mListener.onError(error);
            }
        }

        @Override
        public void onInit(int status) {
            if (mListener != null) {
                mListener.onInit(status);
            }
        }


        @Override
        public void onDoaResult(int doa) {
            if (mListener != null) {
                mListener.onDoaResult(doa);
            }
        }

        @Override
        public void onNearInformation(String json) {
            if (mListener != null) {
                mListener.onNearInformation(json);
            }
        }

        @Override
        public void onSevcNoiseResult(String retString) {
            if (mListener != null) {
                mListener.onSevcNoiseResult(retString);
            }
        }

        @Override
        public void onSevcDoaResult(int doa) {
            if (mListener != null) {
                mListener.onSevcDoaResult(doa);
            }
        }

        @Override
        public void onResults(AIResult result) {
            if (result.getResultType() == AIConstant.AIENGINE_MESSAGE_TYPE_JSON) {
                if (result.getResultType() == AIConstant.AIENGINE_MESSAGE_TYPE_JSON) {
                    try {
                        String resultInfo = result.getResultObject().toString();
                        JSONObject obj = new JSONObject(resultInfo);
                        double confidence = obj.getDouble("confidence");
                        String wakeupWord = obj.getString("wakeupWord");
                        int status = obj.getInt("status");
                        if (mListener != null) {
                            mListener.onWakeup(resultInfo);
                            if (status == 0 || status == 1 || status == 2) {
                                mListener.onWakeup(confidence, wakeupWord);
                            }
                        }
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                }
            }
        }

        @Override
        public void onRawDataReceived(byte[] buffer, int size) {
            if (mListener != null) {
                mListener.onRawDataReceived(buffer, size);
            }
        }

        @Override
        public void onResultDataReceived(byte[] buffer, int size, int wakeupType) {
            if (mListener != null) {
                mListener.onResultDataReceived(buffer, size, wakeupType);
            }
        }

        @Override
        public void onInputDataReceived(byte[] data, int size) {
            if (mListener != null) {
                mListener.onInputDataReceived(data, size);
            }
        }

        @Override
        public void onOutputDataReceived(byte[] data, int size) {
            if (mListener != null) {
                mListener.onOutputDataReceived(data, size);
            }
        }

        @Override
        public void onEchoDataReceived(byte[] data, int size) {
            if (mListener != null) {
                mListener.onEchoDataReceived(data, size);
            }
        }

        @Override
        public void onEndOfSpeech() {
            //do nothing
        }


        @Override
        public void onReadyForSpeech() {
            if (mListener != null) {
                mListener.onReadyForSpeech();
            }
        }

        @Override
        public void onBeginningOfSpeech() {
            //do nothing
        }

        @Override
        public void onRmsChanged(float rmsdB) {
            //do nothing
        }

        /**
         * 废弃使用
         *
         * @deprecated
         */
        @Override
        @Deprecated
        public void onRecorderStopped() {
            //do nothing
        }


        @Override
        public void onEvent(int eventType, Map params) {
            //do nothing
        }

        @Override
        public void onVprintCutDataReceived(int dataType, byte[] data, int size) {
            if (mListener != null) {
                try {
                    mListener.onVprintCutDataReceived(dataType, data, size);
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        }

        @Override
        public void onNotOneShot() {
            //do nothing
        }

        @Override
        public void onAgcDataReceived(byte[] buffer) {
            if (mListener != null) {
                mListener.onAgcDataReceived(buffer, buffer.length);
            }
        }

        @Override
        public void onMultibfDataReceived(byte[] data, int length, int index) {
            if (mListener != null) {
                mListener.onMultibfDataReceived(data, data.length, index);
            }
        }

        @Override
        public void onEchoVoipDataReceived(byte[] data, int length) {
            if (mListener != null) {
                mListener.onEchoVoipDataReceived(data, data.length);
            }
        }
    }

}
