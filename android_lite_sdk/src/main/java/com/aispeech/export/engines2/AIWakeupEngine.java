package com.aispeech.export.engines2;


import android.text.TextUtils;

import com.aispeech.AIError;
import com.aispeech.AIResult;
import com.aispeech.common.AIConstant;
import com.aispeech.common.DynamicParamUtils;
import com.aispeech.common.Log;
import com.aispeech.common.Util;
import com.aispeech.export.config.AIOneshotConfig;
import com.aispeech.export.config.AIWakeupConfig;
import com.aispeech.export.exception.IllegalPinyinException;
import com.aispeech.export.intent.AIWakeupIntent;
import com.aispeech.export.listeners.AIWakeupListener;
import com.aispeech.kernel.Utils;
import com.aispeech.kernel.Wakeup;
import com.aispeech.lite.AISpeech;
import com.aispeech.lite.Languages;
import com.aispeech.lite.base.BaseEngine;
import com.aispeech.lite.config.LocalVadConfig;
import com.aispeech.lite.config.OneshotConfig;
import com.aispeech.lite.config.WakeupConfig;
import com.aispeech.lite.oneshot.OneshotCache;
import com.aispeech.lite.param.WakeupParams;
import com.aispeech.lite.speech.SpeechListener;
import com.aispeech.lite.wakeup.WakeupProcessor;

import org.json.JSONException;
import org.json.JSONObject;

import java.io.File;
import java.lang.reflect.Array;
import java.util.Iterator;
import java.util.Locale;
import java.util.Map;


/**
 * 本地唤醒引擎
 */
public class AIWakeupEngine extends BaseEngine {
    private static final String ACCESSIONALHEX = "F9FFFCFFF8FFFAFFFBFFF9FFFBFFF9FFFAFFFAFFF9FFFBFFFCFFFCFFFCFFFCFFFEFFFEFFFBFFFEFFFBFFFEFFFBFFFBFFFDFFFAFFFCFFFCFFFEFFFDFFFBFFFFFFFCFFFCFFFEFFFEFFFEFFFCFFFCFFFBFFFBFFFDFFFCFFFDFFFDFFFDFFFDFFFCFFFEFFFFFFFDFFFFFFFCFFFDFF0000FDFFFCFFFBFFFBFFFDFFFDFFFAFFFAFFFCFFF9FFFBFFF8FFF8FFFAFFFAFFFAFFFAFFFCFFFAFFFBFFFCFFFCFFFCFFFBFFFCFFFEFFFEFFFEFFFCFFFEFFFFFFFFFFFEFF00000000FFFF0000FEFFFEFF0000000000000200020002000000010000000000010000000100010002000100020001000000040003000300030003000400030004000300040004000100050007000500060006000400050004000500050004000600070007000500070008000600050006000700060005000500060005000600060006000600040008000500060009000600060006000700050008000700030007000700060007000600050005000200020003000100010001000200020003000200020004000000000004000100030005000200040005000100030001000100010001000200FEFF010001000100FFFFFEFFFEFFFDFFFFFFFDFFFDFFFEFFFDFF000000000000FEFF0000FEFFFEFF0100FEFF02000200FFFF02000100010002000100010001000000FFFFFFFF0000FEFFFEFFFDFFFEFFFEFFFEFFFFFFFFFFFEFF01000100FFFF020002000100FFFFFEFF0100FFFFFEFF0100FFFFFFFF0100FFFF0100FFFF0200FFFF02000000FEFF0400FFFF0000020000000100FFFF0000000000000000FFFF0000FFFF0100FFFFFFFF0100FFFF0100000000000000FFFF0000FFFF01000000FDFF0000FFFFFFFFFFFFFFFFFFFFFCFFFFFFFCFFFEFFFFFFFBFFFFFFFEFFFEFF0000FBFFFFFFFFFFFEFF0100FFFF01000200FFFF0000FFFFFFFFFFFFFFFFFFFF00000200FFFF00000000FEFF0000FFFFFEFFFFFF000000000200000002000000030004000100040004000200050002000500070006000400030003000300040004000400050006000600060005000500050005000700070006000800070005000600050006000500050006000300050007000600070006000800070007000700090006000600070004000600040003000400010005000500040006000600080005000700050006000600030005000400070007000600080006000500060003000400050004000400040002000100020000000200030001000000000002000000020002000100FFFFFEFF0100FEFFFFFF01000100FFFFFFFF0100FEFFFFFF01000100FFFF0100010000000200FFFF0300020002000400030003000100020001000100020002000200020002000100030002000200030003000300010004000300030005000500050006000300070005000400060005000500030002000500060004000500040006000600050007000300040007000400070005000600070005000600060005000500050006000600060007000600050004000400050002000400050000000100020000000200FFFFFFFFFFFFFFFFFFFF01000100010001000100FFFF0100FFFFFEFFFEFFFEFFFEFFFEFFFFFFFEFFFEFFFEFFFEFFFEFFFDFF0000FDFFFEFFFEFFFBFF0000FCFFFCFFFDFFFCFFFCFFFAFFFDFFF9FFF8FFFAFFF9FFF7FFFAFFFAFFFAFFF9FFFAFFF9FFF8FFFBFFFBFFFAFFFAFFF9FFF9FFF9FFF8FFFBFFF8FFF8FFFBFFFAFFFAFFFAFFF9FFFCFFF8FFF9FFF8FFF6FFFAFFF8FFF8FFF8FFF8FFFAFFF7FFF6FFF8FFF8FFF8FFF9FFFAFFFCFFFAFFFBFFFBFFFAFFFAFFFAFFFAFFFBFFFCFFFCFFFCFFFBFFFBFFFCFFFBFFFBFFFDFFFDFFFDFFFCFFFDFFFDFFFBFFFEFFFCFFFCFFFFFFFCFFFDFFFEFFFFFFFEFFFFFFFFFFFEFF0000FCFFFEFFFEFFFDFFFEFFFEFFFEFFFEFFFEFFFDFFFEFFFFFFFDFFFEFFFEFFFCFFFEFFFEFFFCFFFEFFFFFFFDFFFCFFFBFFFCFFFAFFFBFFFBFFFBFFFBFFF9FFFAFFF9FFF9FFFAFFF9FFFCFFF7FFF8FFFAFFF8FFF9FFF8FFF8FFF7FFF5FFF9FFF9FFFBFFF8FFFAFFFBFFF9FFFAFFF8FFF9FFF9FFF8FFF8FFF5FFF6FFF8FFF5FFF7FFF8FFF8FFF7FFF5FFF7FFF7FFF7FFF6FFF9FFF8FFF7FFFAFFF7FFFAFFF8FFF7FFF9FFFBFFFAFFFCFFFCFFFCFFFCFFFBFFFBFFFCFFFBFFFCFFFCFFFBFFFEFFFAFFFDFFFEFFFDFFFFFFFEFFFEFF0000000000000100010002000300020002000300030003000300030004000400040004000300020003000300030003000400050004000500040002000400050006000700070009000A0006000800090007000800080007000A00090009000900080009000600070007000800060005000700070007000700050005000500070006000500060004000500050005000600050004000500020001000300010003000200020002000000FFFFFEFFFFFFFDFFFDFFFBFFFCFFFAFFFAFFFBFFF9FFFBFFFAFFFAFFFAFFF8FFF9FFF8FFF9FFF8FFF8FFF9FFF9FFF9FFF8FFFBFFF9FFF7FFFAFFF9FFF9FFF8FFF8FFF9FFF8FFF8FFFAFFFAFFF9FFF9FFF9FFF7FFF8FFF7FFF7FFF7FFF5FFF9FFF6FFF6FFFAFFF6FFFAFFF8FFF7FFF8FFF6FFFAFFF6FFF6FFFAFFF7FFFBFFF8FFFAFFFBFFF6FFFAFFFCFFF8FFFBFFFBFFFBFFFFFFFBFFFCFFFEFFFBFFFFFFFEFFFDFFFFFFFFFFFFFFFEFF00000300020003000100030003000100040001000200020001000200010002000500020001000200000000000200030002000200030001000000FFFF01000000FCFF000000000100010001000000FFFF0100010001000100FFFF0200000001000000FEFF0000FEFF0000FEFFFDFFFCFFFFFFFCFFFDFFFDFFFCFFFCFFFEFFFEFFFDFF0200FDFFFEFFFEFFFDFF0100FDFFFEFF0100FFFFFFFFFFFFFEFFFFFF0100FEFFFEFFFFFFFEFFFFFF01000200010001000300FFFFFFFF00000000000000000200030004000300030002000200020002000200010002000200030006000300030004000400050004000200000002000300010003000300020004000300030004000400040002000100020002000100020002000200010002000100FFFF0200010002000200030002000200040001000100000003000100FDFF0000FDFF01000000FFFF02000000000001000000FFFFFFFF00000100010000000100010001000300000005000200020004000300070004000600050004000600060006000700050006000600050006000600070006000900080007000A0008000D000A000B000B0009000C0009000B000A000B000C000A000B000B000C000A000A000A000A0008000800090009000A00070008000800050009000500050006000400050004000500040004000500030003000200040003000400050003000300030004000400050005000300060004000300030003000100010001000100000000000100FFFF000001000100020002000000020001000000010000000100FEFF02000100FFFF0100FEFF0100FEFFFFFFFEFFFDFF0000FDFFFCFFFBFFFDFFFAFFFAFFFAFFF7FFFDFFFBFFF9FFFCFFF9FFFCFFFAFFFCFFFBFFF9FFFDFFFAFFFAFFF9FFF9FFF8FFF8FFFBFFFBFFFAFFF9FFFAFFF9FFF8FFFBFFF8FFF8FFFAFFF7FFF9FFF8FFF8FFF8FFF6FFF9FFF9FFF9FFF9FFF8FFF9FFFBFFF7FFFAFFF6FFF9FFF9FFF7FFF9FFF7FFFBFFFBFFFBFFFAFFFAFFFAFFF8FFFBFFF8FFFBFFFBFFFBFFFAFFFAFFFDFFFCFFFCFFFDFFFDFFFDFFFDFFFDFFFBFFFCFFFDFFFFFF0000FEFF0000FEFFFEFFFEFFFCFFFFFFFFFF00000200FFFF0000FCFF0000FFFFFEFFFFFFFBFFFEFFFBFFFAFFFCFFF9FFF9FFFBFFF8FFFAFFFAFFF9FFFAFFF9FFF8FFF9FFF8FFFAFFFAFFF9FFFAFFF9FFF9FFF8FFF8FFF7FFF6FFF8FFF9FFF7FFF9FFFAFFF6FFFAFFF9FFF8FFF7FFF4FFF3FFF6FFF5FFF3FFF2FFF3FFF4FFF5FFF5FFF4FFF7FFF7FFF8FFF5FFF7FFF8FFF6FFF9FFF6FFFAFFF9FFFBFFFBFFFAFFFAFFFAFFFCFFFAFFFBFFFAFFFDFFFAFFFCFF0000FBFFFFFFFDFFFBFFFDFFFBFFFEFFFBFFFEFFFFFFFEFF0000FFFF0300FFFF020001000000030000000300010001000200020002000200020003000400060005000500050005000600070007000700090004000600070004000700060004000500070006000600060006000A000800090008000900080007000800070008000600060007000600070007000800080009000800070009000800060007000A0007000700070005000800070006000600070007000400050006000400050003000700060003000500010004000400000004000000000002000000FEFFFCFFFCFFFDFFFDFFFCFFFCFFFAFFF9FFFBFFFAFFFAFFF9FFF9FFFAFFF8FFF9FFFAFFF9FFFAFFFAFFF9FFFCFFF9FFFAFFFAFFFAFFF9FFF9FFF8FFF9FFFBFFFAFFFCFFFBFFFAFFFBFFF9FFFBFFFCFFFAFFFCFFF9FFFCFFFDFFFDFFFDFFFCFFFCFFFCFFFCFFFFFFFBFFFDFFFDFFFEFFFEFFFCFF0200FDFFFFFFFEFFFCFF0100FCFF00000000FEFF000000000100FEFF0100FDFFFDFFFDFFFEFF0000FDFF0000FDFFFFFFFFFFFCFFFFFFFCFFFCFFFCFFFCFFFDFFFBFFFDFFFAFFFFFFFDFFFDFF0000FDFFFEFFFDFFFEFFFDFFFCFFFCFFFBFFFCFFFCFFFEFFFEFFFCFFFEFFFEFFFDFFFEFFFBFFFCFFFCFFFCFFFEFFFDFFFDFFFDFFFDFFFCFFFCFFFCFFFEFFFCFFFCFFFCFFFDFFFDFFFDFFFDFFFAFFFAFFF9FFF8FFFAFFF8FFFCFFFAFFFAFFFDFFF9FFFCFFFBFFF9FFFCFFFCFFF8FFFCFFFBFFF9FFFAFFF9FFFDFFF9FFF7FFFAFFF6FFF9FFF8FFF9FFF9FFF6FFF8FFF6FFF7FFFAFFF9FFF9FFF9FFF8FFF8FFF9FFF7FFF9FFF9FFFCFFFCFFFCFFFCFFFCFFFCFFFBFFFBFFFAFFFDFFFBFFFAFFFAFFFCFFF9FFFCFFFCFFFBFFFDFFFBFFFCFFFCFFFDFFFEFFFBFFFDFFFEFFFEFFFEFFFFFFFEFFFEFF0100FEFFFEFFFFFFFEFFFEFFFEFF0000FEFFFEFF01000000FDFF000001000100020003000200030003000300030003000500040005000600070007000700080009000A000A0008000800080009000700080007000800080006000A0006000B000800050009000600070007000800060007000900060009000700070008000900090007000800070009000800060007000600080008000900090009000B00070009000C000A000B0009000B000C000A000B0009000800080009000A0006000800080008000A0009000700070008000900080009000A00080009000800090007000800070009000900080009000700070007000700090009000A0009000700090006000700080007000700070006000600060007000600040006000500070003000400010001000200010002000000FEFFFDFF0000FDFFFCFF0000FCFFFFFFFDFFFDFFFCFFFAFFFBFFFBFFFBFFF9FFFAFFF9FFF9FFFAFFFAFFF9FFF9FFF9FFF8FFF9FFF7FFF7FFF7FFF7FFF8FFF5FFF6FFF8FFF7FFF6FFF6FFF8FFF7FFF9FFF8FFF9FFFAFFF9FFFDFFF9FFFCFFFCFFFCFFFDFFFCFFFFFFFAFFFCFFFEFFFBFFFEFFFBFFFDFFFFFFFAFFFDFFFDFFFCFFFEFFFDFFFCFFFEFFFDFFFCFF0000FFFFFFFFFFFF00000000FDFF0100FDFF00000100FFFF0100FFFF0200FFFF00000100FBFF0000FDFFFDFFFCFFFBFFFEFFFCFFFCFFFAFFFBFFFAFFF9FFFCFFFBFFFBFFFCFFFAFFFAFFFAFFFBFFFBFFF9FFFCFFFBFFF8FFFBFFFAFFFBFFFAFFFAFFFBFFF9FFFDFFFAFFFBFFFBFFF8FFFBFFFAFFFBFFFDFFF9FFFDFFFCFFFCFFFBFFFBFFFCFFFBFFFCFFFBFFFEFFFBFFFAFFFDFFFBFFFEFFFAFFFDFFFCFFFCFFFEFFFDFFFFFFFCFFFDFFFDFFFBFFFCFFFCFFFEFFFBFFFBFFFBFFFCFFFDFFFCFFFBFFFBFFFCFFFBFFFBFFFEFFFBFFFCFFFDFFFAFFFDFFFEFFFAFFFDFFFEFFFDFFFCFFFDFFFCFFFCFFFDFFFCFFFCFFFBFFFCFFFBFFFBFFFBFFFAFFFCFFFCFFFDFFFCFFFEFFFDFFFDFF0000FDFF00000000000002000200010003000300020004000400070005000500060006000600050007000600050005000600060006000700060008000500060008000700070007000700050006000400060005000600080004000500080006000400050005000500040004000400020004000400030004000000040002000100050000000300FFFF02000300FFFF03000200020004000200010004000300020002000100020002000100010001000100000000000100FFFF0100FFFFFFFF0100FEFF0100FEFFFEFF0100FDFFFEFFFEFFFCFFFDFFFBFFFCFFFCFFFDFFFCFFFCFFFEFFFCFFFFFFFEFFFEFFFFFFFEFFFEFFFDFFFDFFFEFFFEFF0100FEFFFFFFFFFFFFFF0100FEFFFEFFFFFF0100FFFFFFFFFFFFFEFFFFFFFEFFFDFF0000000000000100FFFF0100FFFFFFFFFFFFFDFFFFFFFEFFFEFFFDFFFEFFFDFF0000FEFFFDFF0000FBFFFFFFFCFFFCFF0000FCFFFFFFFEFFFFFF0000FFFF0000FEFFFFFF0000FFFF0100000001000300FDFF010000000100010000000200FFFF0100FFFFFFFF0200FDFFFFFFFFFFFDFFFFFFFDFFFDFFFEFFFEFFFCFFFEFFFCFFF9FFFEFFFBFFFAFFFDFFF9FFFDFFF9FFFAFFFBFFF9FFFAFFF8FFF9FFF8FFF7FFFBFFF8FFFAFFF9FFF6FFF9FFF7FFF8FFF7FFF5FFF9FFF6FFF4FFF7FFF6FFF6FFF6FFF4FFF6FFF7FFF3FFF6FFF5FFF8FFF6FFF3FFF7FFF4FFF5FFF4FFF5FFF5FFF4FFF7FFF6FFF6FFF9FFF7FFF6FFF7FFF4FFF7FFF7FFF5FFF6FFF4FFF6FFF5FFF6FFF8FFF7FFF9FFF7FFFAFFFCFFFAFFFDFFFAFFFAFFF9FFF9FFFBFFFBFFFDFFFDFFFFFFFDFFFEFFFFFFFEFF0000FFFFFFFF0000FEFF0100000000000300FFFF0300FFFF00000100FDFF0200000004000400010005000200050003000300050004000500040006000600050005000300070003000300050003000500040005000600050004000400070005000600050005000500050006000600050005000500060006000700080008000900090009000A000B0008000A0009000600070007000900060009000A0007000800070009000600070008000600040007000800050009000900080007000900080006000A0007000B000800080009000600070006000600080006000600060003000700070007000900090007000600040004000400020004000400050006000600070004000400060005000400050004000500070003000400030003000500030005000500010004000200030002000500020003000300FEFF0300000002000300010004000100040002000100020002000200020001000300010001000300030004000200030003000100030000000100000001000200010004000100020002000200030001000300020003000200FEFF0300000000000300010003000000040002000000040001000200010000000200000001000200FEFFFFFFFEFFFFFFFEFFFEFF0000FCFFFDFFFBFFFCFFFDFFFAFFFBFFFAFFFAFFF8FFF9FFFAFFF9FFF9FFFAFFFAFFFAFFFBFFF9FFFAFFF9FFF9FFF8FFF8FFFAFFF7FFF9FFF9FFF8FFF9FFF7FFFAFFFAFFF7FFFBFFF9FFF9FFF9FFF8FFFBFFFAFFFAFFFAFFFBFFFAFFFCFFFAFFFBFFFCFFFBFFFCFFFFFFFBFFFCFFFBFFFCFFFEFFFDFFFEFFFDFFFEFFFDFFFEFFFFFFFFFF0100FFFFFFFFFFFFFFFFFFFFFEFFFEFFFFFF0200FEFFFEFFFEFFFEFFFEFFFDFFFEFFFCFFFEFFFDFFFCFFFDFFFCFFFCFFFBFFFCFFFAFFFAFFF9FFF9FFFCFFF9FFFBFFFBFFFCFFFEFFFBFFFEFFFAFFFDFFFAFFF9FFFDFFF9FFFBFFF9FFF8FFFBFFF9FFFAFFF9FFFAFFF9FFFCFFFCFFFBFFFCFFFBFFFEFFFEFFFCFFFEFFFDFFFFFFFFFF00000000FFFFFFFFFFFF020004000400040005000500050007000700070008000900090008000A0007000A0008000B000B0008000C000A000B000A0009000A0009000B000A0008000C000A000A000A0008000A0009000A000A0009000A0008000B00080008000C0009000B000A000C000C000A000B000A000B00090009000B0007000800080007000900060006000600060004000500030004000400010004000100040003000200030002000200FFFF03000300020000000300010000000100FFFF03000100010002000200020001000200020002000200010001000400FFFF0300020000000200FFFF03000000FEFFFFFFFEFFFFFFFFFFFDFFFBFFFBFFFCFFFCFFFCFFFBFFFCFFFDFFFBFFFCFFFBFFFCFFFCFFFAFFFDFFFBFFFDFFFDFFFCFFFCFFFBFFFCFFFCFFFBFFFCFFFBFFFEFFFEFFFBFFFEFFFDFFFAFFFCFFFAFFFCFFFBFFFBFFFCFFF8FFFBFFFBFFFBFFFEFFFBFFFEFFFDFFFFFFFEFFFCFF0100FDFF0000FEFF00000000F9FFFEFFFCFFFBFFFCFFFAFFFEFFFBFFFAFFFEFFFDFFFBFFFDFFFDFFFCFFFCFFFCFFFBFFF8FFFBFFF7FFF9FFFBFFF6FFF8FFF7FFF7FFF9FFFAFFF9FFF6FFFAFFF7FFF8FFFBFFF7FFF9FFF6FFF8FFF7FFF6FFF6FFF5FFF6FFF4FFF4FFF5FFF4FFF6FFF4FFF3FFF5FFF4FFF4FFF3FFF0FFF1FFF3FFF1FFF2FFF0FFEFFFF1FFF1FFF1FFEEFFF0FFEFFFF0FFF1FFEFFFF4FFF1FFF1FFF2FFF2FFF4FFF2FFF2FFF4FFF2FFF3FFF1FFF3FFF3FFF1FFF2FFF3FFF2FFF2FFF2FFF1FFF2FFF6FFF6FFF5FFF4FFF7FFF7FFF6FFF7FFF6FFF7FFF6FFF8FFF7FFF7FFF9FFF8FFF9FFFBFFFBFFFBFFFCFFFCFFFEFFFEFFFEFFFEFFFDFFFDFFFDFFFEFFFDFFFDFFFFFFFEFFFFFFFEFFFEFF0100010002000100040003000200040004000300040002000200020001000500030005000600030005000300040006000500060003000300040004000500030004000400040004000500050003000600060005000400050005000500060005000600060007000400050008000400060005000300070005000500050004000400040003000300060003000300040002000500040001000400040001000100020001000300030003000300FFFF03000200000002000200010001000000FFFFFFFF00000100FFFF0000FEFFFFFFFFFFFEFFFFFFFFFFFFFFFFFF01000000FFFF010000000100FFFFFFFF04000000040004000100060002000600060004000800030005000600050005000600040006000700050006000700060008000700080007000800090006000700060005000800050006000600030005000300060007000500060006000500070004000200070003000300050003000400040002000200020002000200020001000200020003000200020002000000000000000000FFFF0100FFFFFEFF000000000100FFFF0000000001000000FEFFFFFF0100FFFFFEFFFFFFFAFFFEFFF9FFF8FFFDFFF8FFFCFF0100FBFFFCFFFBFFFAFFFEFFFBFFFAFFF9FFF9FFFAFFF9FFFBFFFBFFFBFFFCFFFBFFFBFFFDFFFBFFFBFFFAFFFAFFFBFFF9FFFCFFFBFFFAFFF9FFFAFFFBFFF8FFF9FFFBFFF9FFFCFFFBFFFAFFFBFFF9FFF9FFF9FFFAFFFBFFFBFFFAFFFAFFFBFFF7FFFAFFFAFFF8FFFCFFFBFFFBFFFBFFFBFFFBFFFBFFFBFFFBFFFDFFFAFFFCFFFAFFFBFFFCFFF8FFFBFFFBFFFAFFFAFFF9FFFDFFF9FFFBFFFBFFFBFFFDFFFAFFFAFFFAFFF9FFF6FFF9FFFBFFF9FFFAFFFBFFFBFFFAFFFDFFFBFFFDFFFDFFFDFFFDFFFAFFFDFFFBFFFCFFFBFFFBFFFEFFFAFFFEFFFDFFFBFFFBFFFDFFFFFFFEFFFDFFFDFFFEFFFCFFFEFFFDFF00000100FCFF01000000FEFFFEFFFDFFFDFFFDFF0000FDFFFFFF00000000000002000200010000000100000000000200010003000200040006000300050005000600050004000700060008000700040008000600050006000600070007000900080007000A000600070004000600060005000600050006000600050003000500060006000700060007000700070009000700090008000900090009000A000B00090009000B0009000A000B000800090009000B0007000800090008000900070007000600080008000500060003000500050003000300040004000500040006000700050006000400030002000300030001000100010001000100000001000200FFFF00000100FFFF0000FFFFFFFFFDFFFFFFFFFFFDFFFDFFFEFFFEFFFEFF0000FEFFFFFF0100FEFF0100000000000000000000000000030001000200020002000500050003000600030004000500040006000400070003000300060003000500030007000400020002000200060003000700020004000400030006000100060004000300020001000500030004000000000003000300040003000300040004000400020002000200FFFF03000300FFFF02000200FFFFFFFFFFFFFFFFFFFFFEFFFEFFFDFFFFFFFFFFFDFFFDFFFCFF0000FDFFFBFFFCFFFAFFFBFFF9FFFAFFFAFFF9FFF9FFFAFFFBFFF8FFFAFFF7FFF6FFF8FFF7FFF6FFF6FFF6FFF5FFF8FFF7FFF4FFF6FFF4FFF4FFF2FFF1FFF1FFF1FFF0FFF1FFF4FFF0FFF1FFF1FFEFFFF2FFF3FFF2FFF3FFF4FFF4FFF3FFF4FFF4FFF3FFF3FFF2FFF4FFF3FFF4FFF3FFF2FFF9FFF4FFF7FFF6FFF6FFFAFFF5FFF9FFF7FFF7FFF9FFF5FFF9FFF8FFF7FFFBFFF8FFF9FFFAFFF9FFF9FFFAFFF9FFF9FFFBFFFDFFFCFFFBFFFEFFFEFFFEFFFDFFFFFFFDFFFEFFFFFFFEFFFFFFFBFFFFFFFEFFFEFFFFFFFFFF02000300030002000400030003000500040004000400050005000300040004000200030003000100030001000100000000000000FFFF0000010000000100FFFFFFFFFFFFFCFFFFFFFFFFFCFFFBFFFCFFFBFFFAFFFDFFFEFFFAFFFDFFFCFFFCFFFDFFFEFFFEFFFCFF0000FFFF01000100FFFF0000FFFF000000000000FFFF0200000000000200FEFF01000000FEFF0100000000000100010000000200010002000200FEFF03000100010003000200030004000100040001000100040000000400030001000500030003000100030003000200030003000500060005000700060004000700050006000600070007000500060007000500050008000600060006000800080009000A0007000C00070005000A00060007000A0008000900060009000A0007000B000900090009000800090007000A000A000700080009000A000A0009000A000B00070005000600050004000600050003000600040000000300FFFF00000000FEFFFFFFFEFFFEFFFEFFFEFFFFFFFEFFFEFFFEFFFEFFFFFFFDFFFCFFFCFFFDFFFCFFFCFFFCFFFAFFFBFFFBFFF7FFFAFFF9FFF9FFFCFFF7FFFBFFF7FFF7FFFAFFF5FFFAFFF8FFF6FFFAFFF9FFF7FFF8FFF7FFF6FFF7FFF6FFF7FFF6FFF3FFF6FFF6FFF5FFF5FFF5FFF8FFF4FFF3FFF6FFF5FFF4FFF6FFF5FFF5FFF5FFF4FFF4FFF5FFF5FFF3FFF7FFF3FFF5FFF5FFF4FFF6FFF3FFF7FFF4FFF7FFF7FFF6FFF8FFF5FFF9FFF5FFF5FFF8FFF6FFF7FFF4FFFAFFF7FFF4FFF8FFF4FFF8FFF7FFF7FFF9FFF7FFFAFFF7FFF9FFF8FFF8FFFBFFFAFFFBFFFCFFFBFFFBFFFBFFFBFFFBFFFEFFFCFFFCFFFDFFFCFFFDFFFBFFFDFFFCFFFBFFFCFFFBFFFBFFFBFFFDFFFDFFFEFFFDFFFCFFFEFFFCFFFEFFFCFFFCFFFFFFFDFFFDFFFCFFFFFFFEFFFEFFFBFFFCFFFEFFFBFFFDFFFEFFFDFFFDFFFFFFFEFFFDFF0000FDFFFEFFFDFF0100000000000100FEFF0200010002000300030003000400040004000500050004000500050006000400070005000600090006000800080007000A0009000B000C000B000A0009000C0009000C000B000A000C00080009000800070009000600080008000900060006000700070008000700090007000A000700060008000700090007000A000800070008000800070007000A0007000800080006000A0007000B0007000600080006000A0006000800090006000900060006000400060005000500080005000600050003000600060005000500050006000600060006000700040005000600040006000300020006000200030003000300020000000300010003000300040000000100040002000300000002000200FFFF06000200040003000200040001000300000003000100FFFF020000000100000001000000FDFF0000FFFF0000FFFF0000000000000000FFFF0000FFFF00000000FFFF0000FFFF00000100FFFF0100FEFF0100010000000300FEFF01000200FEFF0100FEFF0000FEFFFCFF0100FEFFFEFF01000000FDFFFEFF0000FDFFFEFFFFFFFFFFFFFFFDFF0000FFFF0000FFFFFFFFFFFFFDFFFFFF0000FDFFFFFF0000FCFFFEFFFFFFFEFFFFFFFCFFFFFFFDFFFDFFFFFFF9FFFDFFFCFFFAFFFCFFF7FFF8FFF6FFF6FFF9FFF8FFF9FFF6FFF6FFF7FFF5FFF7FFF6FFF6FFF5FFF4FFF3FFF3FFF3FFF2FFF5FFF3FFF2FFF2FFF0FFF3FFF2FFF2FFF4FFF3FFF4FFF3FFF4FFF3FFF3FFF3FFF5FFF5FFF4FFF9FFF7FFF7FFF9FFF4FFF8FFF6FFF8FFF8FFF6FFF9FFF6FFFAFFF9FFF9FFFCFFFCFFFCFFFBFFFBFFFBFFFBFFFCFFFDFFFDFFFDFFFDFFFCFFFDFFFEFFFDFF000000000000000000000000010001000000020000000100000002000100FFFF0500010003000300030007000100050004000000050002000300060006000600040005000400050005000500060005000200040004000400050005000400040006000500060007000400050005000600070006000600070007000700080005000900060007000800050008000600070007000700080007000900070008000A000900080009000700080009000800070006000700050007000600040004000300030003000500050004000500020002000400020001000400030004000300010003000100020002000400050001000200050003000300030003000300030003000300050002000400060005000700080007000900060009000800030007000500030004000500050005000500030004000700030004000600020006000500050005000200040000000200020000000300030004000400040002000100000001000000FEFF0000FCFFFEFFFCFFFDFFFDFFFDFFFFFFFCFFFEFFFCFFFCFFFBFFFAFFFDFFFCFFF9FFFBFFF9FFF8FFFAFFFAFFF9FFF9FFFAFFF8FFF9FFF8FFFAFFF9FFF6FFF9FFF8FFF8FFF8FFF7FFFAFFF7FFF8FFF9FFF7FFF7FFF7FFF9FFF5FFF8FFF8FFF7FFF7FFF7FFF7FFF5FFF8FFF5FFF6FFF8FFF7FFF8FFF5FFF8FFF6FFF6FFF7FFF4FFF4FFF4FFF5FFF4FFF4FFF3FFF2FFF5FFF3FFF3FFF4FFF5FFF1FFF4FFF3FFF3FFF5FFF3FFF3FFF6FFF2FFF5FFF8FFF4FFF8FFF3FFF7FFFAFFF6FFFAFFF8FFFBFFFAFFFCFFFFFFFCFFFEFFFFFFFEFFFEFFFEFFFDFFFEFFFDFFFFFFFFFFFDFFFFFFFFFFFEFF0100FEFF0100FEFFFDFFFFFFFCFF0000FDFF0000FEFFFBFFFEFFFBFFFCFFFCFFFEFFFFFFFEFFFFFFFEFFFEFFFCFFFEFFFDFFFDFFFFFFFDFFFFFFFEFFFEFFFEFFFDFFFEFFFDFFFEFFFEFFFDFFFEFFFCFFFBFFFDFFFCFFFCFFFEFFFCFFFBFFFEFFFDFFFDFFFDFFFBFFF9FFFCFFFCFFFBFFFDFFFBFFFDFFFCFFFBFFFEFFFEFFFCFFFBFFFEFFFDFFFDFFFEFFFDFFFEFFFDFFFEFFFDFFFEFF0000FDFFFDFFFDFFFFFFFFFFFDFFFFFFFDFFFFFF01000000FFFFFFFF01000100000001000100000002000200030002000200030002000200030000000200040001000300030001000400040005000500020003000700050003000600050005000500030006000300060005000400060004000600060005000700060005000400050006000700070007000700080008000800060006000B0007000800080005000900070008000800060006000600050006000400040005000400";
    private WakeupProcessor mWakeupProcessor;
    private WakeupConfig mConfig;
    private WakeupParams mParam;
    private SpeechListenerImpl mSpeechListenerImpl;
    private volatile byte[] accessionalData;

    private Languages language = Languages.CHINESE;

    private AIWakeupEngine() {
        mConfig = new WakeupConfig();
        mParam = new WakeupParams();
        mWakeupProcessor = new WakeupProcessor();
        mSpeechListenerImpl = new SpeechListenerImpl(null);
        mBaseProcessor = mWakeupProcessor;
    }

    @Override
    public String getTag() {
        return "wakeup";
    }

    /**
     * 唤醒引擎
     *
     * @return 唤醒引擎实例
     */
    public static AIWakeupEngine createInstance() {
        return new AIWakeupEngine();
    }

    public static int getOneShotCacheTime() {
        return AISpeech.getOneShotCacheTime();
    }

    /**
     * 检查唤醒内核是否准备好，外部可以不关注
     *
     * @return true or false
     */
    private static boolean checkLibValid() {
        return Wakeup.isWakeupSoValid() && Utils.isUtilsSoValid();
    }

    private byte[] getAccessionalData() {
        if (accessionalData == null)
            synchronized (this) {
                if (accessionalData == null)
                    accessionalData = Util.hexToByte(ACCESSIONALHEX);
            }
        return accessionalData;
    }

    /**
     * 唤醒引擎初始化
     *
     * @param config   配置参数
     * @param listener 唤醒相关时间的回调
     */
    public void init(AIWakeupConfig config, AIWakeupListener listener) {
        if (config == null) {
            throw new IllegalArgumentException("AIWakeupConfig can not be null!");
        }
        if (!checkLibValid()) {
            if (listener != null) {
                listener.onInit(AIConstant.OPT_FAILED);
                listener.onError(new AIError(AIError.ERR_SO_INVALID, AIError.ERR_DESCRIPTION_SO_INVALID));
            }
            Log.e(TAG, "so动态库加载失败 !");
            return;
        }
        super.init();
        parseConfig(config);
        mSpeechListenerImpl.setListener(listener);
        mWakeupProcessor.init(mSpeechListenerImpl, mConfig);
    }

    private void parseConfig(AIWakeupConfig config) {
        if (config == null) {
            Log.e(TAG, "AIWakeupConfig is null !");
            return;
        }
        Log.d(TAG, "AIWakeupConfig " + config.toString());
        super.parseConfig(config, mConfig);
        AISpeech.setOneShotCacheTime(config.getOneShotCacheTime());
        if (config.getOneshotConfig() != null) {
            mConfig.setOneshotConfig(parseOneshotConfig(config.getOneshotConfig()));
        }
        mParam.setPreWakeupOn(config.isPreWakeupOn());
        if (config.getLanguages() != null) {
            language = config.getLanguages();
        }

        final String wakeupResource = config.getWakeupResource();
        if (TextUtils.isEmpty(wakeupResource)) {
            Log.e(TAG, "wakeupResource not found !!");
        } else if (wakeupResource.startsWith("/")) {
            mConfig.setResBinPath(wakeupResource);
        } else {
            mConfig.setAssetsResNames(new String[]{wakeupResource});
            mConfig.setResBinPath(Util.getResourceDir(mConfig.getContext()) + File.separator + wakeupResource);
        }
    }

    /**
     * 解析oneshot config 配置
     *
     * @param config {@link AIOneshotConfig}
     * @return {@link  OneshotConfig}
     */
    private OneshotConfig parseOneshotConfig(AIOneshotConfig config) {
        if (config == null) {
            throw new IllegalArgumentException("AIOneshotConfig can not be null!");
        }

        OneshotConfig oneshotConfig = new OneshotConfig();

        LocalVadConfig vadConfig = new LocalVadConfig();

        vadConfig.setPauseTime(0);//oneshot set vad pauseTime 0

        if (!config.getResBin().startsWith("/")) {
            vadConfig.setAssetsResNames(new String[]{config.getResBin()});
            vadConfig.setResBinPath(Util.getResourceDir(AISpeech.getContext()) + File.separator + config.getResBin());
        } else {
            vadConfig.setResBinPath(config.getResBin());
        }

        oneshotConfig.setVadConfig(vadConfig);
        oneshotConfig.setCacheAudioTime(config.getCacheAudioTime());
        oneshotConfig.setMiddleTime(config.getMiddleTime());
        oneshotConfig.setWords(config.getWords());

        return oneshotConfig;

    }

    /**
     * 动态调整参数,只能调整唤醒词的thresh
     *
     * @param pinyin 唤醒词，必须在{@link AIWakeupIntent}设置过，参数示例：["ni hao xiao chi"]
     * @param thresh 唤醒词对应的阈值，参数示例：[0.2]
     * @see AIWakeupIntent#setWakeupWord
     * @see #setDynamicParam(String)
     */
    public void setDynamicParam(String[] pinyin, float[] thresh) {
        if (pinyin == null || pinyin.length == 0 || thresh == null || thresh.length == 0)
            return;
        if (pinyin.length != thresh.length)
            return;
        Log.i(TAG, "setDynamicParam:" + pinyin + "," + thresh);
        StringBuilder sb = new StringBuilder();
        sb.append("words=");
        for (int i = 0; i < pinyin.length; i++) {
            sb.append(pinyin[i]);
            if (i < pinyin.length - 1)
                sb.append(",");
        }
        sb.append(";thresh=");

        for (int i = 0; i < thresh.length; i++) {
            sb.append(String.format(Locale.ENGLISH, "%.3f", thresh[i]));
            if (i < thresh.length - 1)
                sb.append(",");
        }
        sb.append(";");

        setDynamicParam(sb.toString());
    }

    /**
     * 动态调整参数，具体请参照 demo
     *
     * @param dynamicParam env 里的参数，key可以是 words thresh 等, value 类型可以是 基础类型、字符串、数组、列表
     */
    public void setDynamicParamEnv(Map<String, ?> dynamicParam) {
        if (dynamicParam == null || dynamicParam.isEmpty()) {
            Log.i(TAG, "setDynamicParamEnv: dynamicParam isEmpty ");
            return;
        }
        Log.i(TAG, "setDynamicParamEnv" + dynamicParam);
        Iterator<String> iter = dynamicParam.keySet().iterator();
        StringBuilder envSb = new StringBuilder();
        while (iter.hasNext()) {
            String key = iter.next();
            Object obj = dynamicParam.get(key);
            String value;
            if (obj == null) {
                continue;
            } else if (obj instanceof Iterable) {
                value = getStringForIterator((Iterable) obj);
            } else if (obj.getClass().isArray()) {
                StringBuilder sb = new StringBuilder();
                int length = Array.getLength(obj);
                for (int i = 0; i < length; i++) {
                    sb.append(Array.get(obj, i));
                    if (i < length - 1)
                        sb.append(",");
                }
                value = sb.toString();
            } else {
                value = String.valueOf(obj);
            }
            envSb.append(key).append("=").append(value).append(";");
        }

        setDynamicParam(envSb.toString());
    }

    private String getStringForIterator(Iterable<Object> obj) {
        String value;
        StringBuilder sb = new StringBuilder();
        Iterator<Object> iterator = obj.iterator();
        while (iterator.hasNext()) {
            Object o = iterator.next();
            sb.append(o);
            if (iterator.hasNext())
                sb.append(",");
        }
        value = sb.toString();
        return value;
    }

    /**
     * 动态调整参数，参数只能是 {@link AIWakeupIntent} 内的参数，
     * 不同引擎可以动态设置的参数不一样，建议使用 {@link #setDynamicParam(String[], float[])} 方法
     *
     * @param env 参数字符串，如："words=ni hao xiao chi;thresh=0.2;"
     * @see #setDynamicParam(String[], float[])
     */
    public void setDynamicParam(String env) {
        if (TextUtils.isEmpty(env))
            return;
        Log.i(TAG, "setDynamicParam:" + env);
        JSONObject envJson = new JSONObject();
        try {
            envJson.put("env", env);
        } catch (JSONException e) {
            e.printStackTrace();
        }
        if (mWakeupProcessor != null) {
            mWakeupProcessor.set(envJson.toString());
        }
    }

    /**
     * 设置唤醒env热更新，可以在引擎初始化成功后动态设置,当前只支持更新thresh
     *
     * @param envJson setJson
     *                须在start启动成功后可以调用
     */
    public void setDynamicParam(JSONObject envJson) {
        Log.i(TAG, "setDynamicParam:" + envJson);
        if (mWakeupProcessor != null) {
            mWakeupProcessor.set(envJson.toString());
        }
    }


    /**
     * 动态调整参数，具体请参照 demo
     * 仅支持intent中设置的唤醒词的阈值修改
     *
     * @param wakeupWord 唤醒词，参数示例：["ni hao xiao chi","xiao bu xiao bu"]
     * @param threshold  唤醒词对应的阈值，参数示例：[0.2, 0.3]
     * @param majors     是否主唤醒词，主唤醒词为1，副唤醒词为0，如 [1,0]
     *                   设置主唤醒词后，内核会对唤醒词部分音频进行回溯
     * @throws IllegalPinyinException {@link IllegalPinyinException} 非法拼音异常
     */
    public void updateWakeupThreshold(String[] wakeupWord, float[] threshold, int[] majors) throws IllegalPinyinException {
        String wakeupParams = DynamicParamUtils.getWakeupWordsParams(wakeupWord, threshold, majors, true);
        Log.d(TAG, "updateWakeupThreshold :" + wakeupParams + "  mDmaspProcessor " + mWakeupProcessor);
        if (mWakeupProcessor != null) {
            mWakeupProcessor.set(wakeupParams);
        }
    }

    /**
     * 设置唤醒词
     * 此功能先内部先执行stop，再执行start，调用者无需再执行start
     *
     * @param wakeupWord 唤醒词，参数示例：["ni hao xiao chi","xiao bu xiao bu"]
     * @param threshold  唤醒词对应的阈值，参数示例：[0.2, 0.3]
     * @param majors     是否主唤醒词，主唤醒词为1，副唤醒词为0，如 [1,0]
     *                   设置主唤醒词后，内核会对唤醒词部分音频进行回溯
     * @throws IllegalPinyinException {@link IllegalPinyinException} 非法拼音异常
     * @deprecated {@link AIWakeupIntent#setWakeupWord(String[], float[])}
     */
    public void setWakeupWords(String[] wakeupWord, float[] threshold, int[] majors) throws IllegalPinyinException {
        Log.i(TAG, "setWakeupWords:" + wakeupWord);
        String wakeupParams = DynamicParamUtils.getWakeupWordsParams(wakeupWord, threshold, majors, true);
        stop();
        if (mParam != null) {
            mParam.setMajors(majors);
            mParam.setWords(wakeupWord);

            if (threshold != null && threshold.length > 0) {
                String[] thresholdStr = new String[threshold.length];
                for (int i = 0; i < threshold.length; i++) {
                    thresholdStr[i] = String.format(Locale.ENGLISH, "%.3f", threshold[i]);
                }
                mParam.setThreshold(thresholdStr);
            } else {
                mParam.setThreshold(null);
            }
        }
        Log.d(TAG, "setWakeupWords :" + wakeupParams + "  mDmaspProcessor " + mWakeupProcessor);
        if (mWakeupProcessor != null && mParam != null) {
            mWakeupProcessor.start(mParam);
        }
    }


    /**
     * 自行feed音频数据，不使用内部录音机时可用
     *
     * @param data 音频数据
     * @param size 音频数据大小
     * @see AIWakeupIntent#setUseCustomFeed(boolean)
     */
    public void feedData(byte[] data, int size) {
        if (mParam != null && !mParam.isUseCustomFeed())
            return;

        boolean isAddExtraAudio = mParam != null && !mParam.inputContinuousAudio() && mParam.isAddExtraAudioWhenFeedNotContinuousAudio();
        if (isAddExtraAudio) {
            int accessionalSize = getAccessionalData().length;
            byte[] revisedData = new byte[data.length + accessionalSize];
            System.arraycopy(data, 0, revisedData, 0, data.length);
            System.arraycopy(getAccessionalData(), 0, revisedData, data.length, accessionalSize);

            if (mWakeupProcessor != null) {
                Log.i(TAG, "revisedData: " + revisedData.length);
                mWakeupProcessor.feedData(revisedData, revisedData.length);
            }
        } else {
            if (mWakeupProcessor != null) {
                mWakeupProcessor.feedData(data, size);
            }
        }
    }

    /**
     * 开启唤醒，如果使用内部录音机的话一并开启
     *
     * @param aiWakeupIntent 配置参数
     */
    public void start(AIWakeupIntent aiWakeupIntent) {
        super.start();
        parseIntent(aiWakeupIntent);
        if (mWakeupProcessor != null) {
            mWakeupProcessor.start(mParam);
        }
    }

    private void parseIntent(AIWakeupIntent aiWakeupIntent) {
        if (aiWakeupIntent == null) {
            Log.d(TAG, "AIWakeupIntent is null !");
            return;
        }
        super.parseIntent(aiWakeupIntent, mParam);
        Log.d(TAG, "AIWakeupIntent " + aiWakeupIntent);

        mParam.setUseCustomFeed(aiWakeupIntent.isUseCustomFeed());
        mParam.setUseOneShotFunction(aiWakeupIntent.isUseOneShot());
        mParam.setContinuousAudio(aiWakeupIntent.isInputContinuousAudio());
        mParam.setAddExtraAudioWhenFeedNotContinuousAudio(aiWakeupIntent.isAddExtraAudioWhenFeedNotContinuousAudio());
        mParam.setWords(aiWakeupIntent.getPinyin());
        mParam.setVad(aiWakeupIntent.isVadEnable() ? 1 : 0);

        if (aiWakeupIntent.getThreshold() != null && aiWakeupIntent.getThreshold().length > 0) {
            String[] threshold = new String[aiWakeupIntent.getThreshold().length];
            for (int i = 0; i < aiWakeupIntent.getThreshold().length; i++) {
                threshold[i] = String.format(Locale.ENGLISH, "%.3f", aiWakeupIntent.getThreshold()[i]);
            }
            mParam.setThreshold(threshold);
        } else {
            mParam.setThreshold(null);
        }

        float[] threshHigh = aiWakeupIntent.getThreshHigh();
        if (threshHigh != null && threshHigh.length > 0) {
            String[] thresholdHigh = new String[threshHigh.length];
            for (int i = 0; i < threshHigh.length; i++) {
                thresholdHigh[i] = String.format(Locale.ENGLISH, "%.3f", threshHigh[i]);
            }
            mParam.setThreshHigh(thresholdHigh);
        } else {
            mParam.setThreshHigh(null);
        }

        float[] threshLow = aiWakeupIntent.getThreshLow();
        if (threshLow != null && threshLow.length > 0) {
            String[] thresholdLow = new String[threshLow.length];
            for (int i = 0; i < threshLow.length; i++) {
                thresholdLow[i] = String.format(Locale.ENGLISH, "%.3f", threshLow[i]);
            }
            mParam.setThreshLow(thresholdLow);
        } else {
            mParam.setThreshLow(null);
        }

        mParam.setCustom(aiWakeupIntent.getCustomNet());
        mParam.setNet(aiWakeupIntent.getEnableNet());
        mParam.setDchecks(aiWakeupIntent.getDcheck());
        mParam.setDumpAudioPath(aiWakeupIntent.getDumpWakeupAudioPath());
        mParam.setDumpTime(aiWakeupIntent.getDumpWakeupTime());
    }

    /**
     * 关闭唤醒，如果使用内部录音机的话一并关闭
     */
    public void stop() {
        super.stop();
        if (mWakeupProcessor != null) {
            mWakeupProcessor.stop();
        }
    }

    /**
     * 强制请求唤醒结果，即使没有唤醒也会给出唤醒词为null的结果
     */
    public void forceRequestWakeupResult() {
        if (mWakeupProcessor != null) {
            mWakeupProcessor.forceRequestWakeupResult();
        }
    }

    /**
     * 销毁唤醒内核和录音机
     */
    public void destroy() {
        super.destroy();
        if (mWakeupProcessor != null) {
            mWakeupProcessor.release();
        }
        if (mSpeechListenerImpl != null) {
            mSpeechListenerImpl.setListener(null);
        }
        if (mParam != null) {
            mParam = null;
        }
        if (mConfig != null) {
            mConfig = null;
        }
    }

    /**
     * The adapter for convert SpeechListener to AILocalWakeupListener.
     */
    private class SpeechListenerImpl extends SpeechListener {
        AIWakeupListener mListener;

        public SpeechListenerImpl(AIWakeupListener listener) {
            mListener = listener;
        }

        public void setListener(AIWakeupListener listener) {
            this.mListener = listener;
        }

        @Override
        public void onError(AIError error) {
            if (mListener != null) {
                mListener.onError(error);
            }
        }

        @Override
        public void onInit(int status) {
            if (mListener != null) {
                mListener.onInit(status);
            }
        }

        @Override
        public void onResults(AIResult result) {
            if (result.getResultType() == AIConstant.AIENGINE_MESSAGE_TYPE_JSON) {
                JSONObject obj;
                double confidence;
                String wakeupWord;
                try {
                    obj = new JSONObject(result.getResultObject().toString());
                    String recordId = result.getRecordId();
                    if (!obj.isNull("confidence") && !obj.isNull("wakeupWord") && !obj.isNull("status")) {
                        int status = obj.optInt("status");
                        confidence = obj.getDouble("confidence");
                        wakeupWord = obj.getString("wakeupWord");
                        if (mListener != null) {
                            if (status == 4) {//pre wakeup happens
                                mListener.onPreWakeup(recordId, confidence, wakeupWord);
                            } else if (status == 1 || status == 0) {//real wakeup happens
                                mListener.onWakeup(recordId, confidence, wakeupWord);
                            }
                        }
                    }
                } catch (JSONException e) {
                    e.printStackTrace();
                }
            }
        }

        @Override
        public void onBeginningOfSpeech() {
            //nothing here
        }

        @Override
        public void onRawDataReceived(byte[] buffer, int size) {
            if (mListener != null) {
                mListener.onRawDataReceived(buffer, size);
            }
        }

        @Override
        public void onResultDataReceived(byte[] buffer, int size, int wakeupType) {
            if (mListener != null) {
                mListener.onResultDataReceived(buffer, size);
            }
        }

        @Override
        public void onVprintCutDataReceived(int dataType, byte[] data, int size) {
            if (mListener != null) {
                try {
                    mListener.onVprintCutDataReceived(dataType, data, size);
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        }

        @Override
        public void onEndOfSpeech() {
            //nothing here
        }


        @Override
        public void onReadyForSpeech() {
            Log.d(TAG, "onReadyForSpeech");
            if (mListener != null) {
                mListener.onReadyForSpeech();
            }
        }

        @Override
        public void onRmsChanged(float rmsdB) {
            //nothing here
        }


        /**
         * @deprecated 废弃，勿用
         */
        @Override
        @Deprecated
        public void onRecorderStopped() {
            //nothing here
        }

        @Override
        public void onEvent(int eventType, Map params) {
            //nothing here
        }

        @Override
        public void onOneShot(String word, OneshotCache<byte[]> buffer) {
            super.onOneShot(word, buffer);
            if (mListener != null) {
                mListener.onOneshot(word, buffer);
            }
        }

        @Override
        public void onNotOneShot() {
            //nothing here
            Log.d(TAG, "onNotOneShot: ");
        }

        @Override
        public void onNotOneShot(String word) {
            if (mListener != null) {
                mListener.onNotOneshot(word);
            }
        }

        @Override
        public void onRawWakeupDataReceived(byte[] wkpData, int length) {
            Log.d(TAG, "onRawWakeupDataReceived");
            if (mListener != null) {
                mListener.onRawWakeupDataReceived(wkpData, length);
            }
        }
    }
}
